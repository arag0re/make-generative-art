const Noise=function(t){null==t&&(t=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[];for(var i=0;i<256;i++)this.p[i]=Math.floor(256*R.rbet(0,1));this.perm=[];for(i=0;i<512;i++)this.perm[i]=this.p[255&i];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};Noise.prototype.dot=function(t,i,r){return t[0]*i+t[1]*r},Noise.prototype.noise=function(t,i){var r,s,h=(t+i)*(.5*(Math.sqrt(3)-1)),o=Math.floor(t+h),e=Math.floor(i+h),p=(3-Math.sqrt(3))/6,a=(o+e)*p,m=t-(o-a),n=i-(e-a);m>n?(r=1,s=0):(r=0,s=1);var l=m-r+p,d=n-s+p,f=m-1+2*p,u=n-1+2*p,M=255&o,c=255&e,g=this.perm[M+this.perm[c]]%12,x=this.perm[M+r+this.perm[c+s]]%12,v=this.perm[M+1+this.perm[c+1]]%12,N=.5-m*m-n*n,S=.5-l*l-d*d,q=.5-f*f-u*u;return 70*((N<0?0:(N*=N)*N*this.dot(this.grad3[g],m,n))+(S<0?0:(S*=S)*S*this.dot(this.grad3[x],l,d))+(q<0?0:(q*=q)*q*this.dot(this.grad3[v],f,u)))};
const piano = 'data:audio/mpeg;base64,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';
const bass = 'data:audio/mpeg;base64,SUQzAwAAAAACK0NPTU0AAAB5AAAAAAAAACAwMDAwMDAwMCAwMDAwMDIxMCAwMDAwMEE2RCAwMDAwMDAwMDAwMDNGMTAzIDAwMDAwMDAwIDAwMDBCMkM3IDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwQ09NTQAAAHkAAABYWFgAIDAwMDAwMDAwIDAwMDAwMjEwIDAwMDAwQTZEIDAwMDAwMDAwMDAwM0YxMDMgMDAwMDAwMDAgMDAwMEIyQzcgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDBUWFhYAAAAGwAAAFNvZnR3YXJlAEdhcmFnZUJhbmQgMTAuNC4z//sQZAAAAGUAToUAAAAOoAewoYgAAoBXgBjRAAA7guuTBCAArD8Ewff/8EPrB/5c+D4Pg+D4jD6gQ///KA+H1MG+dCMnmEs7Ol5q9v2zjcb/8htAAAAYAAAA9X8XpZn9C/UqOAD0InP/+xJkAo+wmiFdhzTgAA+BjB7hFAGCQElyDDDggDwJK4CQKMiDaj9H/Ut/8IDf/1//5AAAGBIBQAAAP8j9YGJX2BJkQtD22lIzz49/yf/w2e+j+IxtU1l4hhIP9i7f8qGJz6I+AJoZz2L/+xBkAw8wnyFcAaA7EA4g65QIA0ACdIVuCYC2ADoBrVDDCACX5nUSP/PAa3/5T//UXAAcb8CEbSwtqOBDcz+UJoJyJpFRZKH5h/yb/+NZ/O3/+CAkYAaiEFwnII+eldFHy9UugZ4ovf/7EmQCjzCaIVuBoDsQDyDrdBgmMgJMhXAMGOBAPIKtkLSICISDfL+In/qAtP/1//0HweP8AxQSv4SD9TcAJ3v9F0UKFs4ENfyH/H//hg3/9P/+SGQ7AADhcDzNppEiUFf/LIQLBHfwkP/7EGQDDzCYIVwB4DmQDgDrZDAlEAKMhWwHgUZAOYYt0HAJiHuX/49/6AuO//f//iwxC1UAMhWtygzdMYO/64ABcUl8N6FZj3/ir/6hi3/6//6EYLn4AohCL8TCLc9NcC+iKIIYkVVL//sSZAMPMKAhWwJgLYANIls1NAJiAqyHagew4kA0g61gYQgCI0Py9/y9/8chHyf/6gYgAAOEwKWob/0Mv/wzzg8CPm9ILe+Kf+JP/wSJf/nf/5oYYE+wHAQjDipSPik9P10pAhkQRclB//sQZAOPMKEhWoJgFYALoYtoHAJjAtiFZgwBpkA7CSxAoAmIxv8sf8nv/jkt5//9A54GGAAaBErmiz83GiIFOqG1ynWdfkn/yD/6g/J//s//9Y8jgKodaLgvfymP/8F+v+VVLICONND/+xJkAo/wniHagiA7EA5hiwA9YgQCWIVoCQBWQDeGK8DACMhyiRT8wxf/8Baf/p//xhm4XYunSE9/B/8b5d//9JNAQ4aSNAVFvm//Kn/rHk1/6AdQA4v4vi74T/j/R+r+UZgEIak+l5v/+xBkA4/wpCFZgeBRkA5BiuA0AmICjIVmCYD2ADqB60DyvADxLf8W//gTP/+V//1FomhYlJo+hfP08R8n//iEjQjklVMkKm/zb/kx/6xdoen/+ocugtQJ7AL1Oc9/w1+39T0vAFAGZv/7EmQCjzCXIVoBoBWAD0DczgEgF4JshWYMLOJANwYtkFAVCJWSX5j/zP/44F+b//QOAO90AUAAAAHOCfVSe38Q0AXg/G4RCH8bf8Uf/DRL/9f/+SA44HHEBHkD4bZl/hP61TEB9FtSnP/7EGQDDxCIIVoCIC2QDaGLVBQCcQJghWYIAFYANAIwNACIRh2/nf+d/9Y6W/8MAT13FCBJsLCDUtdUvBLBt0W9pYHe/zn/Mv/jUT9P/9A4FWwwAgoFDVkdH+X/WikCDCDLUZjuf5n///sSZAWPMJQhWYJAFZAO4Ys0IKIFAnCHZAaA7EA7iasA0AmIy7/8i6X/UCBSF21Dg+mFAL7wNma3UIYgRYrPKxgG+XMbf/CU3/9f/+MM4xDbMgX3q7NL/8CFf/5OqjBTeJQGP8n/yP/w//sQZAYPEJchWYMLOCAMolrQLAcyAgCFZgaAVgAuiSwUcAjhJHf/p//oPkwTu4Ioerq3+//qIWMgGwLbKi/+3/f/41/T//iiBIgJJ46CDS/+gBPVAo/QCA8IAAFhXhzYGg72RVj/8b//+xJkCgFQ3CFa6ekQIBGCSvUoAmICwIVcDD1AgDgJLBSwCOD4Ayf/B//8YIQAEwAQbYuELXz8f/0FM//rjIhyTW3TKev8l/5f/2AuJm/+z//0IyDWLjnRUQ/J/8G76/4muAimvNttHhr/+xBkBA/wqCFXAeBRkAvCSvAsAjgClIdcDC1AgDkJK4DQCYiPv+W/88B03/9P/9RaaA/HHpibi//gH/+iaGZGk5EDWn8Y/8n/9AML/+v//FDGoKEzysuN9WI/+K/V/LphALyljVbjHv/7EmQED/CnIVcB4DmQDAJK4CwCOALYh1gMNOJAMIksANAJiNFH/If+oDzv/1//0G58NAvXQw4//wFv/9U2YHs3wlYWVvEf/jd//ANIv/9P/9QdOdCZJZwx/Xt/8F//ojIGkDJNLI4G7f/7EGQEjzCpIdcCQFMQDsJK9SQFOAKQhVoGgUxANokrQHAJiDTIP/QJRf/9//9hQzAiAsfduSDuxf/4T/V/LmILIOB5gHll+W5H/6g+Z/+v/+UH5oAJfE4jfriP/gDv/5aOksQcpQUA//sSZAOP8K4hVgMGOAAMwkrwLAIyAmyHWgeA5kA7CStAkBTIL+ot/1HP/gGEf/0//1ErCpl7RJUn/X/4E//+iEIwRVfcptxK/5X/0CZ//0//4c2isW2xgUwn/4z/1C3f/02JDrH43qSx//sQZAOP8KEhVoMAUZAOQkrgKAViAliFWAgAtkA4iStAsBTIjce/8i/9Qmt/+///H5oPmvKBT/tjf/hB/1fyxVACxJUqAmLfKX/Mf/ULQv/qATB0iD9MTc3/Gf/A7P/6FSmA6jjQTIz/+xJkA4/woyFWgiA7EA7iSuAsAjICgIVaCICsQDmJK0DQHYgu/lmo2/9Red/+n//DLgKE7zEdFS/8v/xLfr/lyOAhhxIzIbdvOYd/9QBL/+//+gHQJYgZgHlvpZ3/wif//LI8A6hIWMz/+xBkAw/wlyFWgaAVgA1EKvAoArIChIVUCYD2QDkJK0CwFMh5P8z/5S/+O5/X//UMUBk3FxD+v/b/4lt/4xGgguQ1UsjIV+VH/yRb/rH2r/sGVCwurcF7t/3/+ADvr/l6NgSAV2cwGf/7EmQDj/CSIVYBoCsQDqJKwDAFMgJUhVYJgFZANpCrQKAdmD+faG//AD/+n//B8CbuwpmW3b/b/4GPf/xMYAVgLgXLA73q5r/yW/+Vkv+oY0XG5ocb5vxC3/6f/8tVggL6Btq6W3Ev+P/7EGQFD/CVIVaB4CmQDMJKwBwHZgHkSVwHgEZAM5CrAKAKyL//AVv/1//4KcIVeJglT53wgb9f8vDBYnnryvMwf/Ef/Bf/4jKiBfQFf6///8Wzv/FKjggUJmuVIflP+P/+oLf1fxIP//sSRAkP8IkSVQMLOBAQpCrANAKyAhyFVAaAVkBCkKsAoArIgIYeS5ULW/q/5v/8pJf+KOA7hEH7EFXye/+c/9ROf/xJCALHKjIGs75X/kH/xAt/4iojgDKT+4q3+TH/JX/5k//gZgB4//sQZAmP8IMhVIIgFZAMZCrQHAU8AfRJVggArEAzEKtAcArIxlAz8B0////8WLAJBJVFkrP8v4S/+E//8sNwJ8oE7//9f/lm/8RVOgzB4ysShvlDEX/5Fv/1//4czACGcC36Zv/QBn//+xJkDo/wkyHUgaA7EAziSsAcBWICJIVWB6BAgDOQqwBwCsj/xWUaJcZAQp8V/wL/5v/6//6AY6CYxic7//zf/hf/4pVIHwSLSoedfl1v8u//Iv/qBHgOm5oUn//nf/Hn/wRACmNl1jL/+xBkEg/whyFUgaAVkA0kKsAoBbICKIVSBoD2ADoQqoBwCsit5e/5e/+TPp//w5xJD2lAc/r/yP/xk7/oHRoHhzzAx+J8T/8cf/9f/9AMwJA7lBS/0/7//IW/6ihOGxnkpy242sQVHf/7EmQVD/CGIVSA4BMQDgQqwCgCsgL8S2AGBKZAN5CqwKAWyLmEQf/VBowNM/b+sOEQSnyMQyft/mf/F3/wRSkCELi5iTn5//lT/4/q/8MEQiVI0n6f8Tb/7/9BbaEDSttAS/yP+gl//P/7EGQVDzCCIVkCAC2QDSQqoBQCsgJshWIHrOJAOwKr0JAISBYv/6f/6EwAOBuBY2/hW0nZNX//+WWUAlR9OvK/xt/wef+gNJf/r//qNgAEBfRBY/r8/A5jf//+gyBIKy7j0/zHFf/w//sSZBcPsKAhV4HgOZAOgYsEHCkOAlSHYAgA7EAxBirAoAmIWkf/1//4w0CIPuKDfnYT5Z//8upQEhRlSD8p/xd/6Awvp//oByhLVTgf+v/X/4f//ExiDSd5G/T/5N/+SaXm//1AmgEG//sQZBiP8IchWAFAFYANAkrAPGIEAgyFYgaAVgAsgetAwJhA3THdns+Y//3VSCcC2acMfzD/kl/8oo+v//DjgAtFHOnP15f/QJP//lzgGEUNIjv9P/l3/47n/6C2FUjPjo31Yt/8J///+xJkHY/wjCFXgaA9gA5CSqA0BWIB+IVgBoBWQDMJKsDQFYj6VUQi5BedNvz3/L3/x/+n/+oYmAlcTG/r/yP/yDf+MmCckNqI2fpYF/+AC//r//wVhYEM04D7t5mDf/A3/+XVKQNI5mD/+xBkIY/whiFYAaAVgAzkKqAcArICJIVeBoCsQDoJKkCgFYg8/mP/K3/yJJev/+gHo03+XE2z/8T/8L//iZhXF55kPP85/yz/1jhb0//1DXAYAOAJD8dDGJ9P//+hMQC6npjc/1/8p//7EmQkjzCQIVcCAC2ADUJKsCQCMgI0hVwGgFYAN4Or4HAIyP+ofP/grgOGcUAVb52N9f/+XMkZ4EB7IMA/T/gH/wP/+v//Fh4IZN+WAvcr5f///SowAfh2PUMH9PB//8JSP/6f/6jwcP/7EGQngTB7IVeBoC2QDGGKsBwCYgJEhWKmJEAAMgIsIBCkAGGYAAEBYx7dXlPp//0FECKNFKWDv6H/KH/yHP6f/8FYlBh4ZhYRz/n/hv//P0wGaJ21xff5v/yf/6yKh6//6AdiQASG//sSZCwPEJUhVYIgOxAOwIsZBCkCAjyFWAgAtgA2gesUYpgIIbTICOZTyn7v/5YyBBCeqLJS/b/WWP/lxv+oaCmEfOF/9P/r/+n/8QomQriaH5iKgh8vYV/9hKT/9P/+CLQAKNPCW6P///sQZC4PMJghVYGgLYAPAIq1LQkCAhCFWAiAVkAzkKrA0ArIu//lyPAppPqkYO2/kz/ya/+TLf8wHKwrxtzpc/f///q/9RW4CEMWs/JG37C3/B7/6Ap//X//URioL/IA1b7f9P/q3/j/+xJkMA/wpSHUggA7EAqgirAwCRACUIVUCQC2QDSQqoDQCsjGQBIOxai+LE7eU7/yLf/IGr0//4IprPyw8r5v+v/wn/+XGdCGRkcfIgxFvIY/+Ob/6Y2SI+n/+UAu7iANmQU/69P/n///+xBkMw/wpiFUAwA5kAykKqAoArICoIVQCAD2ADKJKoCQCMjp//wIzCxLbkwUWurL//Jb/1Dif1//1AiAD+Kwdfmf8r/83/4YoC6gb6YT9JJ/xZ/9QxM//b//QLLQCRnCgxmny31f///7EmQzj/DDIdKCQD2ADmQqgDQCYgKAhVAGgFYANJCqQHAWyIjNQBxoikgl1/v4u/9AgX/9P/9BLOAcGwQEU0eV///xNT4DNW0rJJvtin/oBhb/9f/9QkKhGGMTAH/nf87/8ZsBcN9EIP/7EGQyD/CjIdOB4FGQC+CKoBxJEAJwhVAFgOxAL4IqgJEgCM+d/xf/6ga3/7f/8MqgDZ2HE15Xyv//+XXAzKH6hE3Jv/Fn/wp//T//QXuoA0LeMREfp/yb/6hjoEKilMhv/Of8l//l//sSZDQP8JMhVAGgKxAL5CqgHAKWAkyFTges4IAvgiqAkSxA9/+oJQYDbYbW//6P/2b/xlAEGWlQ1+P/8SP/iSW/8FQCYleUH/6/8v/87/4uKGPQqCC/M/0Ef/0CI/0//0DzofTV5mIt//sQZDgP8JEh1AGAOZAMZCqAKAKWAgCFUAaAVkAyEKqA0ArI/tjf/B//4mUgAnnSgKfydv8VP/iud/1BFA4ZxCI37/8//7f/DFh9I7Sol/0KDf/jv/6//6ArEoKLCHdHq///xGpICkP/+xJkPI/wfCFUgOAtkA1EKpAoArICOIVQA4D2ADgJKkDQCYhmpjr+//Mv/pP/4uQFBDbDwE+//B/u//loNihsPOmT/bAX/4W3/6f/6jEIQyVIV4YG+72fZ//uJkEEm6rDx+l/ye/+eb//+xBkQI8wgSFTgUAVkAzkKpAcBbICFIVSBoCsQCsCK9RwnA7wWx9HPkGDT4X5f//EcYTRLa3I99f+Bf/QSf/9f/+LuFxsLEnb575z//PVKgJUQNIjv85g3/xr//4sw3NzAhb6f83/5//7EmRGDxByIVSBoBWQDUGKkCQCMgIohU4IAKxANQHrFPEkCD/+GGoBJiJdjo9nbzP/kD/5c/+CuBknxGFf8/N/8L//xGomwDEad2ECMvyp/xp//K6v+cG3IAnE+4Jv9v+b/8g/+KcIIv/7EGRLj/B8IVQCQC2QC+GKgCwCOAI4hVIHgKZALQHqgLKkCC2RhOt82b+sgn/uY/+oKGSYvGH7/87/7v/41SRCHG1JicJ3+Xf+Pf/1nP/MDLGJTI2wot9HG/+Fd//EZ0M5L6E6NL8y//sSZFEP8HcSVIGgKxANBCqQKAWyAiiFTAaAtkA1CSoAoBWIf/KH/1/+guFCa5UTf1Y//wn/+WWgAMKatlySTUd/4G//Xf///+ojIJg3zg6/1/7f/d//GH4KY9mAeUPnKhF/9D//0//4//sQZFYP8Jgh0YIAPZANhCqAKAKyAiCFSggAVkAvkKpAoArItY4FEYZWOb9WL+V//xGqMQH0h4zHfyf/xw//U//QDUSxblQQb65P/gv/8sSQFwL+ZCm/XJD/WMN/9SX/UCUnLYwBS33/+xBkWQ/wlSHSgaA9kA3CSoA0AmIB/IVMCABWQDEJKkDQCYg/5//x//8aFwAokxeFN+P/+F7/8j/+CqKTcVBPk/+Jd//EZoCC2VFjfLf8Xf/b/4txwIZmC87e3+or/+Js/p//qBoeAP/7EmRcj/CZIVEB4DmQDKQqoCgCsgJQh0oGgOxAM4YqQNAJiHLPKAi3yX/Lf/Jf+oY0I2yo0/T/p/8V//GUHRukiFf83/l//kv0//0BYDo/aYFKn1y//ADv/8R1FwPDp+LT/O/5J/6FP//7EGRfD/B+IVIBoBWQDKJKoBwCYgJEhUYGgFZANRCqAKAKyPQWkJA/BAfZ574d//zzfOUuG5dUjaZi+A5im0VFA/+yghCC3yf6yBwMRzTHX9P/t/8x/+MqOBCGS5mNJ/lzER/6BKL///sSZGMP8H8hUgFALZALgkqQHAI4AbSFTAOAVkBHEKkA0BbA/p//xNEAAHAbBHE4rNH/qd//EZoBYMeVEj8v/xv/8D0/6CyIElE5F7Axst5T6v1fy1VYVqeog/o4h/8BHfX/FgUoABBB//sQZGgP8HghUoDgFZAMRCqgHAKyAgCFSgUAtgA4iSoAoAmIYSaUGusP///oUGwfacM/zL/lf/yWf/wWgwgZw67an8p8l//iNWAcLOGvx3/ir/4Qt6f/8WsIMo50vZ//gv/8smEGY5X/+xJkbQHwdyFTAUAVkAvAeqAk4gADMEtWpJRpQDQQqkDQCsiYfnKCr/6Bgv/6//6lEBEGtUWN8z/mf/H//jJRaH6gxvj+Hv/gGb/8v//BVBXH9SP6ev/xDv/61A8JZw1/MMV/+BS//p//+xBkbo8QnCFVAgBTEA6ginUw5gIB9IVYA4BWQDmCKhTxHAD/weDsY4b/b/j3/xGf/xVgTGNBf+f/yX/ws//UEUDE6m/Nl/+F//0//46ElT1m357/ln/xjoev//BXAyO6hYZ/NqK/+P/7EmRwDzBwElaBoCsQDgGK1BwCRgHYhVYGgLZAMwIpwPOoAIO//xGqUEwS0Sh+bY//4EL/+n/+gueBhdpQSf0xPyz/r/ljALBzygk/juKf/Az/q/iw6D87KBv9cf/6v/+n//GqWDhWqv/7EGR2j/B7IVWA4BWAC0JKgDQCOAI0hVIGgUxANZCpwHAKyIp/mWT/9Qq3/6//8jEIy0qGvzMR8p//iNYBCAIQQPqb9cn/wn/+kwHHZBhHf5/7//89MgYkM6UPzDE//gc99X8WNgmB//sSZHuP8IIhVQDgKxAMAkpwNAJiAgCFVAaArEAykKlAcArIxqBB/b/of/R/+GGgCw49BN/I/+Lv/iq3n//4lgJg+eUN/f/r/87/0ForAMo984X/y4/+V/+oan8v//B3YkAGSpWx+V9X//sQZIGP8G0hVYDgFZANZCpgCAViAfCFVAaAtgA6iSlAoAmIy//+WIgaCmDdrI/5u0e/+Eaf/p//qUODUPzZUp+//Jf/mf/GMAT4lHlaX5r/zH/3LDXzf/8FMgaFbFn7VFf/H//p//z/+xJkho/wgyFVAaArEA0himAcAmIB5ElUA4CsQDqQqYBwCYhaID+avOjY3zbD3/wCf/8b//oDqiYY3qFvdf6jf/Eu+v+Jqj4LASLY2q+SP/JX/4z/Z//6gjEGM9qP/r/5//5l/8ZYJMn/+xBkiwHwgyFVAaA7EAvhimAcAmIByElhIQBMQC2B6cBhGEAjUU3+VYu/+EC//j3//FomCA7VFv0x3/wt31fy9RSNBjHxd+If+Lf/i8l57f/0DbohBPyh+vH/+Ed//ExUDVZxOONbhf/7EmSSD/B4ElQBoCsQDaQqYDQFsgIchU4FAFYANJCpgKAKyB/6F//hKf5f/9Qygrq8gNcR/8z//r//xoQcDzNQ1/G//If/EZ3/+Of/6BmQXUNwR/+X+V//y70mxHY8kHcaf89/+oXM///7EGSXATCYIdMBoC2ADMCKhTwiAwJYhU6mgOxANhCpQKAKyPdv/8XvYBAyrUD7q8p8p+r+JjoJUnWuW/zfCf/AC//hf/9QhEA8Scv+v/X/5z/+MxBJE34MIVk4n/h//gM//4h//oBY//sSZJkP8JAhUoGgLYAOpCpQNAJiAlCFSgaArEA8iSkAsAjIbBj0Gi/T/p/8r/8WiDqMfkEVa2Nv+Of+o6//49//oGzEEum84Y/vl/+C/V/ExmAPNKovr+SNQP/4T/+f//UIeAwNtB1///sQZJoP8JAhUYGgFYANBCpQNAKyAjyFRgaA7EA2CSlAUBWIm/9//k//xNWwiju9Q/8Qf8Q/9Qf/+z//0AqAVzPWUv0tv/if/6//8WZIzYLM2Ef/H//Ualv/x7//QPOA4yM+Rvzu//r/+xJknI/wlSHRAOA9gAxCSjA0AmICWIVCA4BWADWQqQCACOAIH//xMibBCmqslvyAPCf/BN/+dv/6gBwQjOg/+n/b/57/+MgNoptmbt5LoIF//F2//Ef/9AKTQEIQq6yFT+U/+f/9ZMr/+xBkn4/wmCFQgeo4kAsgalA8ogACeIdCB4DmQDSCKMDFmAg/9APVPhCE806cdvPYl/6irf/p//w2gSYxJ/DZvEP+O/+FP/+v/+okSAAgsPVPy7RH/4Uf+W/iRYI+QXrPfv/z//zP///7EmSiD/CLIVECIBMQDEQqYCgCsgJ8hUIHiKPAMZCpAHAKyIwshLL6q2/NcC/+Bv/+v/+glYHURarFn6P/Pf/Zv/FlQSAWzUXf5ew7/6iv/9v/+GpAOwgZGcJ938vNF/+gF//X//UCIv/7EGSlj/CeIVAB6DggDaJKMDQCYgIwhUAGgExANRCpAKAKyAgSwECUScx/kO//w36v6kQbpDAPsZjSf53/mH/yy3/QOKxAQpHy6tXjN/qIP/yb9W//wKwJc1edKH6H/R/+TPp//oLq//sSZKcP8I8hUAHnKMAOhCpANAJiAkSFQAMA5kA4iSiA0B2ITFUeeiRvyTb/I7/+k/r//wY0Auxt0iW/O4v/7gQv/6//6CaYNwTrln5cwT/4i3/7f/8EIoGCWtdf5xcU/+AQt/+n/+oG//sQZKkP8JEhT4IAExAMRCpAHAKyAliFPgaArEBIEKfBEBbI2SqgTPCVDPwOT/AP/4X//N//oBWCUHD6nv87f/0EH/9P/+TXIScIxi/4L/w5/9G//X//QHghazxt5Y24j/yf/Adn/8T/+xJkqQ/wjiFQAgArEBIkKhA8BTIB9ElCBQCsQDWQqQDQCsjVUAKJ9yEiNbxt/xn/87/1DOAVRzoOdHg30v+d/+Si//DIBxfUsvyP/Kfp//xJkDQPJpgPH9f/V/8vf+gtiQdxgH/N/xH/+xBkqw/whCFQggATEA3kKjA0ArICKIVCBoCsQE2Qp8EQCYj/41v/FJhJR1zrfpf9f/zL/0BicBYylQLL8df/FX/wgX/qCIAdCEvQ/O+oVv////FKJgNDTSoY/Kf8d/+Ljv+gMoBMJv/7EmSrgfCAElNBQBMYEcQp8EAHsgJUhToGgLYAP5CogNAKwD0JfzP+3/yn/xDkoZFtBz9dP/hXf/0pgWTu4y/0/+//0//QPSAA4w+M/ma//ARv/8WMAphq8oa3//X/4u/+MfDCU86bfv/7EESrj/CIIVABoC2AEeQp8DQFYgIEhUAGgKxASBCngNAViP/0v/n3/8SoClL+cN9P/h//8urQKApq9fI1eJ+hML/8BJFv///+Gx+DmAg2uMr9P/mv/y63/UCleT3tKgeNtX3iFbl2//sSZKsP8J4hToMHKJAPhCoQKAdiAiiFPgesoAA/iShA8BTIzsaF7/oqFQnIuzt/p//xxicEEUtih+r/pf+oy/+NUFYlmQ83+Z/8uf+serf+JYGxG9Q7zf8T9f/+XYMzK9MTXM/4//8D//sQZKsP8H8hToFAFZAQpCoANAWyAYSFQAOAUoA8kKhA0ArIn//X//lzoSpRykV9+jhv/xF//8TKJAggCAAUKrlSH74L/4f//U8BAAATHEWTH6vR///ogQLtMBn5uF/+IX/9P/+JYBD/+xJErw/wZyFRAKAVkA2EKhA0ArICEIU8A4C2QDYQqADQCZiGQc0GP1/+n//ThKJMXCv+diX/wMb/8///HmIGWHDmIlDfV8K7/+JjQoxruG35uNf/gRd8r/KMDdIbTg8f09f/hP/9CnD/+xBEtQPwfCFPgOAVkA1kKhAoArIBkElMpQBMYDUQp8DQCsiaN8Xj78pkv/hB//T//QiXg6C+0nDB/oPT/4G//+XQJBNkIWG+v/Jf/j//48FEhmYik/m+f/4C7/+WUAoYygS/mY//wP/7EmS7j/BqElCA4CsQDWQqICgCsgGwhUIGgFZALQkowNAI4E79f8SFQSDsTjn5un/wr//QaCNciCn/P/5b/4lP/4mCRmWbQhHzN/n/+Bv//l44CQ7KhTft/y//qK/0//464IH85wU5C//7EGTED/CgIU4B4jlgEEQp4DQCsgOYh0YGGOdAN5CogNAKyP8n/xnf/y0A0e3lQI83/FP/gRv1/xIggucG7/T/m//Iv/jViKp5gNFvo/9P/1EWS/6CYT1xmIb8j/53/qR//FwyHtEw//sSZL6P8H4hU4GgFZAMAYogLAIyAhiFTAWA5kA7iSeBEBWIP0+Pf8c/+Bren//DZCsurKRJUn/E//AG//xMOBiVmYtn+dx//4QHf/4kQCQmaYIX9/+d/9//jKG4oeLxcvzP+Rf/G7+v//sQZMMBEIMSVkjgExANoIpoJCIRAeCFTgOATEAvgimUo4gC//EsSQJQ0zhv+2N8q7/+XqEUeF6m4KJ75N/6iG/+mK1Nf/zD//UPboAQ5ZlYyn+lj/+gJ3/8TFwIoQ6h8Iqb+g/+d///+xJkyI/wfyFSgUArEA2iSfA0AmYB3ElKBQDsQDQJKMDQCYgDj/0/xJAJCc88ViQZ9f+N8v//ogDQjASygHJCxHrVGRel2k94vceltvcK5NgyWxAqZlfIPtWPy3cR1lAEDfSATjkDeSj/+xBkzg/wgSFSAUA7EA8iShA0AmIBvIVKBQBWQDeJKEDQCYg18Ct5NnKP3npmJ7GjZ8vvj4awPOwhPMPr6c2YixP80v489CgKu+CvnftqPcRcseTqNAIBRatNI0JQ0oGv9FVMQU1FM//7EmTSj/BzElKA4BMQDIJKIBwFYgHEhUoFAFZAOwkoQPWIEC4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7EGTZD/B9IVKBQBWADkJKECQCMgHoSUYEgKZAMRCogKAKyFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sSZN4P8HohUYIAFZANZCoQKAKyAhSFRAOAtgA6iSgAsAjIVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sQZOKPMHgSUQGgOxAM5CowKAKyAhCFRAUAVgA1hikUoAmMVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+xJk54/wvyHOAwmAEA8CSgA0AmICUElCFNOAADmGKIKOIABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+xBE5gABRyLOBkFAACqEueDHnAAB1AkaHDAAADSCpUOMAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==';
const AudioContext=window.AudioContext||window.webkitAudioContext;let audioData={};const audioContext=new AudioContext,loadSample=(t,e)=>window.fetch(t).then(t=>t.arrayBuffer()).then(t=>audioContext.decodeAudioData(t,t=>{audioData[e]=t}));let timeout1,timeout2;loadSample(piano,"piano"),loadSample(bass,"bass");let audioContexts,contextIndex=0;const generateAudioContexts=()=>{audioContexts=[new AudioContext,new AudioContext,new AudioContext,new AudioContext,new AudioContext];for(let t of audioContexts)play(0,0)},getAudioContext=()=>(++contextIndex===audioContexts.length&&(contextIndex=0),audioContexts[contextIndex]),play=(t,e=.2,o="piano",d=!1)=>{audioContexts||generateAudioContexts();try{const d=getAudioContext(),a=d.createGain();a.connect(d.destination);const n=d.createBufferSource();n.buffer=audioData[o],n.playbackRate.value=2**(t/12),n.connect(a),a.gain.value=e,n.start(0)}catch(t){console.error("Error playing sound")}"bass"!==o&&d&&(clearTimeout(timeout1),clearTimeout(timeout2),timeout1=setTimeout(()=>{play(t,.3*e,o,!1)},500),timeout2=setTimeout(()=>{play(t,.09*e,o,!1)},1e3))},playBass=(t,e=.2)=>{play(t,e,"bass")},playReverb=(t,e=.2,o="piano")=>{play(t,e,o,!0)};let musicTimeouts=[];const victoryMusic=()=>{playSong([{t:8,d:100},{t:10,d:100},{t:12,d:100},{t:19,d:100},{t:10,d:100},{t:12,d:100},{t:14,d:100},{t:19,d:100},{t:12,d:100},{t:14,d:100},{t:16,d:100},{t:24,d:400}])},lostLifeMusic=()=>{playSong([{t:4,d:100},{t:3,d:100},{t:2,d:100},{t:1,d:100},{t:0,d:100}])},gameOverMusic=()=>{playSong([{t:-12,d:250},{t:-13,d:250},{t:-14,d:250}])},pauseMusic=()=>{playSong([{t:0,d:100},{t:12,d:100}])},unpauseMusic=()=>{playSong([{t:12,d:100},{t:0,d:100}])},addPowerUpMusic=()=>{playSong([{t:11,d:100},{t:12,d:100},{t:16,d:100},{t:19,d:100}])},pickUpPowerUpMusic=()=>{playSong([{t:11,d:200},{t:12,d:200},{t:16,d:200},{t:19,d:400},{t:23,d:400},{t:24,d:400}])},playSong=t=>{let e=0;for(let o=0;o<t.length;o++)setTimeout(()=>{play(t[o].t)},e),e+=t[o].d},stopMusic=()=>{for(let t of musicTimeouts)clearTimeout(t);musicTimeouts=[]};
const T=THREE,seed=parseInt(tokenData.hash.slice(0,16),16);class Random{constructor(e){this.seed=e}rdec(){return this.seed^=this.seed<<13,this.seed^=this.seed>>17,this.seed^=this.seed<<5,(this.seed<0?1+~this.seed:this.seed)%1e3/1e3}rbet(e,t){return e+(t-e)*this.rdec()}rint(e,t){return Math.floor(this.rbet(e,t+1))}rch(e){return e[Math.floor(this.rbet(0,.99*e.length))]}}const R=new Random(seed);Number.prototype.map=function(e,t,n,o){return(this-e)*(o-n)/(t-e)+n};const scene=new T.Scene,camera=new T.PerspectiveCamera(45,1,.1,1e3);camera.position.set(0,-5,10),camera.lookAt(0,-.4,0),camera.userData.currentY=0;const renderer=new T.WebGLRenderer({antialias:!0}),PI=Math.PI,TAU=2*PI,SIZE=Math.min(window.innerWidth,window.innerHeight);renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(SIZE,SIZE),document.body.appendChild(renderer.domElement);const BALL_RADIUS=.1,W_RADIUS=5.5,BATTON_DEPTH=.1,BATTON_SPEED=.02,BATTON_SEGMENTS=5,CUBE_MIN_Z=-20,BATTON_ARC=PI/12,LARGE_BATTON_ARC=PI/6,MAX_LAYERS=5,POWER_UPS_SPEED=.005,BALL_DISTANCE=.05-5.4,POWER_UPS_COOLDOWN_FRAMES=300,PALETTES=[{name:"vaporwave",ball:"#f54275",batton:"#f723f0",segments:["#ffffff","#fefefe"],hit:"#fbd4fc",core:"#f723f0",background:"#8db8de"},{name:"lava",ball:"#d42400",batton:"#1e2123",segments:["#fff019","#fcc719","#ffa617","#f46629"],hit:"#d42400",core:"#1e2123",background:"#4b6169"},{name:"ochre",ball:"#ebd38a",batton:"#f5b642",segments:["#fae1b4","#ffeecf","#fff7e8","#f5f2ed"],hit:"#f5d95d",core:"#f5b642",background:"#541603"},{name:"reef",ball:"#ffc949",batton:"#f7406b",segments:["#6d9eeb","#475698"],hit:"#f8bd89",core:"#f7406b",background:"#31c3d0"},{name:"tactical tomato",ball:"#fab700",batton:"#fe5f55",segments:["#f7f7ff","#bdd5ea","#577399"],hit:"#cfdbd5",core:"#fe5f55",background:"#495867"},{name:"forest",ball:"#38a3a5",batton:"#22577a",segments:["#c7f9cc","#80ed99","#57cc99"],hit:"#ef0090",core:"#22577a",background:"#55b7a2"},{name:"cake",ball:"#d1b3c4",batton:"#b392ac",segments:["#fee6e4","#f7d1cd","#e8c2ca"],hit:"#ef0090",core:"#b392ac",background:"#f9a59d"},{name:"vibrato",ball:"#b5179e",batton:"#f72585",segments:["#3a0ca3","#3f37c9","#4361ee","#4895ef"],hit:"#d42400",core:"#f72585",background:"#560bad"},{name:"charcoal",ball:"#333",batton:"#484848",segments:["#b8b6bf","#8b8a8e","#616063"],hit:"#eeeeee",core:"#484848",background:"#dbe5e6"},{name:"heaven",ball:"#fbbc04",batton:"#5c92ea",segments:["#f1f8fc","#dcebf4","#b6d7eb","#8dc8eb"],hit:"#fceba3",core:"#5c92ea",background:"#57cfff"},{name:"blood moon",ball:"#ffffff",batton:"#f5f3f4",segments:["#e5383b","#ba181b","#a4161a"],hit:"#660708",core:"#f5f3f4",background:"#0b090a"},{name:"olive oil",ball:"#d8a48f",batton:"#bb8588",segments:["#efebce","#d6ce93"],hit:"#f6aa1c",core:"#bb8588",background:"#a3a380"}],CHORDS=[[0,4,7,11],[0,3,7,11],[0,4,7,10],[0,2,4,7],[0,2,6,9],[0,2,4,6,8,10]];let higherScale,lowerScale;const layersDice=R.rch([1,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,5,5,5,5,5,5]),paletteDice=R.rch([0,0,0,0,0,0,1,1,1,1,1,1,2,2,2,3,3,3,3,3,3,4,4,4,4,4,5,5,5,6,6,6,7,8,9,10,11]);class Options{constructor(){this.ballSpeed=.05,this.rotationSpeed=R.rbet(.001,.008),this.coreType=R.rbet(0,1)<=.3?2:1,this.coreRadius=R.rbet(.3,1.5),this.coreDetail=R.rint(1,3),this.density=R.rbet(.8,2),this.radiusDistortion=R.rbet(0,1),this.transposeMusic=R.rint(-4,4),this.chord=R.rch(CHORDS),this.palette=paletteDice,this.layers=layersDice,this.terrainRes=R.rint(7,30),this.wireframeOn=R.rbet(0,1)<.008,this.spiral=R.rbet(0,1)<.3&&layersDice<=3,this.topOrnament=R.rbet(0,1)<.2,this.bottomOrnament=R.rbet(0,1)<.2,this.rotateCore=R.rch([0,0,0,0,0,1]),this.colorDistribution="random",this.hasPowerUps=layersDice>=3}}const options=new Options,palette=PALETTES[options.palette];palette.segments.length===layersDice&&(options.colorDistribution=R.rbet(0,1)>.5?"asc":"des");const generateSegmentsParams=(e,t)=>{let n=[];for(let o=0;o<e;o++){const e=options.hasPowerUps&&R.rbet(0,1)<=.2,o=e?R.rint(1,2):0;let a;if("random"!==options.colorDistribution){let e="asc"===options.colorDistribution?t:palette.segments.length-1-t;a=palette.segments[e]}else a=R.rch(palette.segments);n.push({height:R.rbet(.1,3),radiusDistortion:R.rbet(-options.radiusDistortion/2,options.radiusDistortion/2),color:a,isPowerUp:e,powerUpType:o})}return n};let randParams={layers:[]};for(let e=0;e<options.layers;e++){const t=8*(e+1)*options.density;randParams.layers.push({segments:t,xRotation:R.rbet(-.5,.5)/options.layers,yRotation:R.rch([-.5,-.25,-.225,-.2,-.175,-.15,-.125,-.1,-.05,0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1])/options.layers,zRotation:R.rbet(-.5,.5)/options.layers,spacing:R.rbet(.5,2)*(e+1)*.5,rotationSpeed:options.rotationSpeed*R.rbet(.5,1.5),depth:R.rbet(.01,.1),segmentsParams:generateSegmentsParams(t,e)})}if(options.topOrnament||options.bottomOrnament){const e=R.rint(10,25);randParams.ornamentParams={segments:e,depth:R.rbet(.01,.1),xRotation:R.rbet(-1,1),yRotation:R.rbet(-.2,.2),zRotation:R.rbet(-.2,.2),rotationSpeed:options.rotationSpeed*R.rbet(.5,1.5),depth:R.rbet(.01,.1),segmentsParams:generateSegmentsParams(e)}}const module=e=>Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2)),ambientLight=new T.HemisphereLight("white","white",.6);scene.add(ambientLight);const pointLight=new T.PointLight("white",.6);pointLight.position.set(2,1,5),scene.add(pointLight);const coreLight=new T.PointLight(palette.core,.7);let interval;coreLight.position.set(0,0,0),scene.add(coreLight);let currentScale=0,currentKey=0;const generateScales=()=>{higherScale=options.chord.slice();const e=options.chord.length;for(let t=0;t<e;t++)higherScale.push(options.chord[t]+12);higherScale=higherScale.map(e=>e+=options.transposeMusic),lowerScale=options.chord.slice().map(e=>e+=options.transposeMusic)};generateScales();let balls=[],batton={angle:1.5*PI,segments:[],size:BATTON_ARC,currentColor:palette.batton},cubes=[],allItems=[],powerUps=[],layers=[];const GAME_STATUS={idle:"idle",starting:"starting",playing:"playing",paused:"paused",gameOver:"gameOver",victory:"victory"};let coreMesh,gameStatus=GAME_STATUS.idle,lives=3,livesMesh=[],powerUpsCooldown=Math.floor(150),scoreboardVisible=!1,boardVisible=!1,score=0,clock=new T.Clock(!1),gameTime=0,playingFrames=0;const formatTime=e=>{const t=~~(e/3600),n=~~(e%3600/60),o=~~e%60;var a="";return a+=(t<10?"0":"")+t+":"+(n<10?"0":""),a+=n+":"+(o<10?"0":""),a+=""+o},resetBatton=()=>{batton.angle=TAU-PI/2,batton.shooterTimeout=0,batton.currentColor=palette.batton,batton.targetSize=BATTON_ARC},startGame=()=>{play(0,0),gameStatus=GAME_STATUS.starting,resetBatton(),clearPowerUps(),3===lives&&(score=0,clock=new T.Clock(!1),gameTime=0,buildBoard()),0===balls.length&&buildBall(),clock.start()},restartGame=()=>{lives=3,gameStatus=GAME_STATUS.idle,renderer.setClearColor(palette.background,1),ambientLight.intensity=.5,pointLight.intensity=.8,coreLight.intensity=.7,resetBatton(),rebuildWorld(),removeBoard(),resetBalls()},appendStyles=()=>{const e=renderer.domElement.clientWidth,t=renderer.domElement.clientHeight,n=e/100;insertCss(`\n    #sc {\n      width: ${e}px;\n      height: ${t}px;\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      margin-left: -${e/2}px;\n      margin-top: -${t/2}px;\n      color: black;\n      box-sizing: border-box;\n      font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";\n      text-align: center;\n      font-size: ${3*n}px;\n      overflow: hidden;\n    }\n\n    #sc h1 {\n      position: absolute;\n      left: 0;\n      top: ${4*n}px;\n      padding: ${2*n}px 0;\n      width: 100%;\n      background-color: ${palette.segments[0]};\n      border-bottom: 4px solid ${palette.segments[palette.segments.length-1]};\n    }\n\n    @keyframes appear {\n      0% {\n        opacity: 0;\n        transform: scale(0.3, 0.3);\n      }\n      90% {\n        opacity: 1;\n        transform: scale(1.1, 1.1);\n      }\n      100% {\n        opacity: 1;\n        transform: scale(1, 1);\n      }\n    }\n\n    #sc .main-box {\n      box-sizing: border-box;\n      padding: ${6*n}px;\n      width: 85%;\n      height: auto;\n      margin: ${25*n}px auto 0;\n      animation: appear .3s forwards;\n      -webkit-animation: appear .3s forwards;\n      background-color: rgba(255, 255, 255, .8);\n      border-bottom: 8px solid rgba(200, 200, 200, .8);\n    }\n\n    #sc .score {\n      margin: 0 auto ${2*n}px;\n    }\n\n    #sc .score > div:first-child {\n      text-align: right;\n      margin-right: ${n}px;\n    }\n\n    #sc button {\n      font-size: ${4*n}px;\n      padding: ${2*n}px ${3*n}px;\n      background-color: #ddd;\n      border: 0;\n      border-bottom: 4px solid #ccc;\n      margin-top: ${5*n}px;\n      cursor: pointer;\n    }\n\n    #sc button:hover {\n      background-color: ${palette.segments[0]};\n    }\n\n    .ui-box {\n      padding: ${n}px ${2*n}px;\n      font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";\n      font-size: ${2*n}px;\n      background-color: rgba(255, 255, 255, .6);\n      border-top: 4px solid rgba(200, 200, 200, .8);\n      box-sizing: border-box;\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      height: ${7.2*n}px;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      animation: appear .3s forwards;\n      -webkit-animation: appear .3s forwards;\n      color: #444;\n    }\n\n    #cc_score_time {\n      width: ${28*n}px;\n      margin-left: ${e/2-28*n}px;\n      margin-top: ${t/2-7.2*n}px;\n    }\n\n    #cc_score_time .row {\n      display: flex;\n    }\n\n    #right_panel {\n      width: ${16*n}px;\n    }\n\n    #cc_score_time .row:not(.hearts) > div:first-child {\n      margin-right: ${n}px;\n    }\n\n    .hearts {\n      min-width: ${7*n}px;\n    }\n\n    .hearts > div {\n      width: ${1.5*n}px;\n      height: ${1.5*n}px;\n      margin-right: 4px;\n      border-radius: 50%;\n      background-color: ${palette.ball};\n      box-shadow: 0 1px 1px 1px rgba(0, 0, 0, 0.3);\n    }\n\n    .new-best {\n      position: relative;\n      top: -${1.7*n}px;\n      font-size: ${2*n}px;\n      background-color: tomato;\n      padding: ${n/2}px;\n      border-radius: 3px;\n      width: ${12*n}px;\n      margin: 0 auto;\n    }\n  `)},gameStartAnimation=()=>{camera.position.z<12.8?(camera.position.z+=.1,camera.position.y-=.06):gameStatus=GAME_STATUS.playing},togglePause=()=>{gameStatus===GAME_STATUS.paused?(gameStatus=GAME_STATUS.playing,unpauseMusic(),clock.start()):(gameStatus=GAME_STATUS.paused,pauseMusic(),clock.stop())},victory=()=>{clearPowerUps(),victoryMusic(),gameStatus=GAME_STATUS.victory},loseLife=()=>{lostLifeMusic(),lives-=1,resetBalls(),resetBatton(),clearPowerUps(),updateLives(),gameStatus=GAME_STATUS.idle,0===lives&&gameOver()},gameOver=()=>{gameStatus=GAME_STATUS.gameOver,gameOverMusic(),removeBoard()},dimScreen=()=>{ambientLight.intensity>0?(ambientLight.intensity-=.05,pointLight.intensity-=.05,coreLight.intensity-=.05,renderer.setClearColor("black")):(gameStatus=GAME_STATUS.paused,setTimeout(restartGame,1e3))},lightScreen=()=>{ambientLight.intensity<2?(ambientLight.intensity+=.025,pointLight.intensity+=.025,renderer.setClearColor("white")):(gameStatus=GAME_STATUS.paused,setTimeout(()=>{restartGame(),buildScoreboard(),emitResults()},700)),expandLayers()},clearAll=()=>{for(let e=0;e<=allItems.length;e++)scene.remove(allItems[e]);cubes=[]},getMaterial=e=>new T.MeshPhongMaterial({color:e,flatShading:!0,wireframe:options.wireframeOn}),rebuildWorld=()=>{clearAll(),build()},buildSphericalCore=(e=options.coreRadius)=>{const t=getMaterial(palette.core),n=new T.OctahedronGeometry(e,options.coreDetail);return new T.Mesh(n,t)},buildCore=()=>{if(1===options.coreType){const e=buildSphericalCore(options.coreRadius);scene.add(e),allItems.push(e),coreMesh=e}else if(2===options.coreType){const e=getMaterial(palette.core),t=new T.ConeGeometry(options.coreRadius,2.3*options.coreRadius,4),n=new T.Mesh(t,e);n.rotateX(PI/2),n.position.z=1.4*options.coreRadius;const o=new T.Mesh(t,e);o.rotateX(-PI/2),o.position.z=1.4*-options.coreRadius,scene.add(n),scene.add(o);const a=new T.Group;a.add(n),a.add(o),scene.add(a),allItems.push(a),coreMesh=a}};const buildBatton=()=>{batton.segments.forEach(e=>scene.remove(e)),batton.segments=[];const e=getMaterial(batton.currentColor),t=batton.size*W_RADIUS;batton.segmentLength=1.1*t/BATTON_SEGMENTS;const o=new T.BoxGeometry(BATTON_DEPTH,batton.segmentLength,.5),n=batton.size/BATTON_SEGMENTS;let a=batton.angle-(batton.size-batton.segmentLength/5.5)/2;for(let t=0;t<BATTON_SEGMENTS;t++){const t=new T.Mesh(o,e);t.userData.isBatton=!0,t.position.set(W_RADIUS*Math.cos(a),W_RADIUS*Math.sin(a),0),t.rotateZ(a),a+=n,allItems.push(t),batton.segments.push(t),scene.add(t)}},updateLives=()=>{document.getElementById("cc_lives").innerHTML=`\n    ${lives>=1?"<div></div>":""}\n    ${lives>=2?"<div></div>":""}\n    ${3==lives?"<div></div>":""}\n  `},resetBalls=()=>{for(let e=0;e<balls.length;e++)scene.remove(balls[e]);balls=[],buildBall()},buildBall=(e={})=>{const t=new T.Vector3(e.x||0,e.y||BALL_DISTANCE),o=getMaterial(palette.ball),n=new T.IcosahedronGeometry(BALL_RADIUS,1),a=new T.Mesh(n,o);a.position.set(t.x,t.y,0),a.userData.direction=e.direction||new T.Vector3(0,1,0),a.userData.collisionsEnabled=!0,scene.add(a),allItems.push(a),balls.push(a)},buildLayer=({radius:e,segments:t,depth:o,spiral:n=!1,z:a=0,xRotation:s=0,yRotation:i=0,zRotation:r=0,spacing:l=1,rotationSpeed:d,segmentsParams:c})=>{const m=new T.Group;m.userData.rotationSpeed=d;const u=5*e/(t*l),g=TAU/t;let p=0;for(let l=0;l<t;l++){const d=getMaterial(c[l].color);0!==a&&(d.transparent=!0,d.opacity=.4,d.color.lerp(new T.Color(palette.core),.8));const b=new T.BoxGeometry(o,u,c[l].height),h=new T.Mesh(b,d);h.userData.height=c[l].height;let S=e;S+=n?1.2*l/t:c[l].radiusDistortion,h.position.set(S*Math.cos(p),S*Math.sin(p),a),h.rotateZ(p),h.rotateZ(r),h.rotateY(i),h.rotateX(s),h.userData.zRotation=r,h.userData.isPowerUp=c[l].isPowerUp,h.userData.powerUpType=c[l].powerUpType,p+=g,cubes.push(h),m.add(h)}allItems.push(m),scene.add(m),layers.push(m)},insertCss=e=>{const t=document.createElement("style");t.styleSheet?t.styleSheet.cssText=e:t.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(t)},removeScoreboard=()=>{el=document.getElementById("sc"),el.parentNode.removeChild(el),scoreboardVisible=!1},buildScoreboard=()=>{scoreboardVisible=!0;const e=document.createElement("div");e.innerHTML=`<div>\n    <h1>VICTORY!</h1>\n    <div class="main-box">\n      <div class="score">\n        Time: ${formatTime(gameTime)}\n      </div>\n      <div class="score">\n        Score: ${score.toLocaleString()}\n      </div>\n      <button id="restart_game">\n        Play again\n      </button>\n    </div>\n  </div>`,e.id="sc",renderer.domElement.parentNode.insertBefore(e,renderer.domElement.nextSibling),document.getElementById("restart_game").onclick=(()=>{removeScoreboard(),startGame()})},emitResults=()=>{const e=new CustomEvent("results",{detail:{seed:seed,score:score,time:gameTime}});window&&window.dispatchEvent(e)},removeBoard=()=>{el=document.getElementById("cc_score_time"),el&&(el.parentNode.removeChild(el),boardVisible=!1)},buildBoard=()=>{const e=document.createElement("div");e.innerHTML='<div class="row">\n    <div id="cc_lives" class="row hearts">\n      <div></div>\n      <div></div>\n      <div></div>\n    </div>\n    <div id="right_panel">\n      <div id="cc_time">\n        00:00:00\n      </div>\n      <div class="row">\n        <div>Score: </div>\n        <div id="cc_score">0</div>\n      </div>\n    </div>\n  <div>',e.id="cc_score_time",e.className="ui-box",renderer.domElement.parentNode.insertBefore(e,renderer.domElement.nextSibling),boardVisible=!0},updateBoard=()=>{gameTime+=clock.getDelta(),boardVisible&&(document.getElementById("cc_time").innerHTML=formatTime(gameTime),document.getElementById("cc_score").innerHTML=score.toLocaleString())},expandLayers=()=>{for(let e of cubes){const t=e.position.clone().normalize();e.position.add(t.multiplyScalar(.025*e.userData.height))}},buildLayers=()=>{let e=options.spiral?1.1*options.coreRadius:1.8*options.coreRadius,t=(.7*W_RADIUS-options.coreRadius)/options.layers;for(let o=0;o<options.layers;o++)options.spiral&&1===o&&(e=.5*W_RADIUS,t=(.75*W_RADIUS-e)/options.layers),buildLayer({radius:e,spiral:options.spiral&&0===o,...randParams.layers[o]}),e+=t;const o={radius:1.5*options.coreRadius,...randParams.ornamentParams};options.topOrnament&&buildLayer({...o,z:4}),options.bottomOrnament&&buildLayer({...o,z:-4})},buildTerrain=()=>{const e=new Noise,t=new T.PlaneGeometry(25,25,options.terrainRes,options.terrainRes),o=new T.MeshPhongMaterial({color:new T.Color(palette.background).lerp(new T.Color("white"),.3),flatShading:!0,wireframe:options.wireframeOn,transparent:!0,opacity:.7}),n=new T.Mesh(t,o);n.position.set(0,2.5,-7),scene.add(n),allItems.push(n);for(let o of t.vertices)o.z=.5*e.noise(.3*o.x,.3*o.y)},build=()=>{renderer.setClearColor(palette.background,1),buildCore(),buildBatton(),buildLayers(),buildTerrain()};renderer.setClearColor(palette.background,1),buildCore(),buildBatton(),buildLayers(),buildTerrain();const moveBalls=()=>{for(let e=0;e<balls.length;e++){const t=balls[e];t.position.add(t.userData.direction.clone().multiplyScalar(options.ballSpeed)),module(t.position)<options.coreRadius&&victory(),detectBallCollision(t),detectBallFalls(t)}},moveBatton=()=>{if(batton.movingRight?batton.angle+=BATTON_SPEED:batton.movingLeft&&(batton.angle-=BATTON_SPEED),batton.targetSize>batton.size&&(batton.size+=.01),batton.targetSize<batton.size&&(batton.size-=.01),batton.shooterTimeout>0&&(batton.shooterTimeout-=.1,batton.currentColor=palette.ball,batton.shooterTimeout=parseFloat(batton.shooterTimeout.toFixed(1)),4===batton.shooterTimeout||3===batton.shooterTimeout||2===batton.shooterTimeout)){const e=new T.Vector3(Math.cos(batton.angle+PI)*BALL_DISTANCE,Math.sin(batton.angle+PI)*BALL_DISTANCE,0),t=new T.Vector3(R.rbet(-.1,.1),R.rbet(-.1,.1),0);buildBall({x:e.x,y:e.y,direction:e.clone().multiplyScalar(-1).add(t).normalize()}),playBass(R.rch(lowerScale))}batton.largeTimeout>0&&(batton.largeTimeout-=.1,batton.largeTimeout=parseFloat(batton.largeTimeout.toFixed(1))),0===batton.largeTimeout&&(batton.targetSize=BATTON_ARC),0===batton.shooterTimeout&&setTimeout(()=>{batton.currentColor=palette.batton},1e3)},movePowerUps=()=>{for(let e of powerUps){e.userData.animationIndex+=.2;const t=e.userData.direction.clone().multiplyScalar(POWER_UPS_SPEED);e.position.add(t),e.userData.torus.position.add(t);const o=Math.sin(e.userData.animationIndex).map(-1,1,.5,1);e.scale.set(o,o,o),e.userData.torus.scale.set(o,o,o);const n=module(e.position),a=detectPowerUpCollision(e);(n>7||a)&&(scene.remove(e.userData.torus),scene.remove(e),e.userData.outside=!0)}powerUps=powerUps.filter(e=>!e.userData.outside)},clearPowerUps=()=>{for(let e of powerUps)scene.remove(e.userData.torus),scene.remove(e);powerUps=[]},fallCubes=()=>{for(let e of cubes)e.userData.isFalling&&(e.position.z>CUBE_MIN_Z?(e.material.transparent=!0,e.material.opacity-=.05,e.position.z-=.1):e.position.z<=CUBE_MIN_Z&&(e.visible=!1))},rotateLayers=()=>{let e=-1;for(let t of layers)t.rotateZ(e*t.userData.rotationSpeed),e=-e;0!==options.rotateCore&&gameStatus!==GAME_STATUS.victory&&coreMesh.rotateZ(options.rotateCore*layers[0].userData.rotationSpeed)},detectBallCollision=e=>{const t=e.position.clone();for(let o=0;o<TAU;o+=PI/4){const n=new T.Vector3(t.x+BALL_RADIUS*Math.cos(o),t.y+BALL_RADIUS*Math.sin(o),0),a=[...batton.segments,...cubes];for(let t=0;t<a.length;t++){const o=a[t],s=new T.Box3;if(s.setFromObject(o),s.containsPoint(n))return void hit(o,e)}}},detectPowerUpCollision=e=>{const t=e.position.clone();for(let o=0;o<TAU;o+=PI/4){const n=new T.Vector3(t.x+BALL_RADIUS*Math.cos(o),t.y+BALL_RADIUS*Math.sin(o),0);for(let t=0;t<batton.segments.length;t++){const o=batton.segments[t],a=new T.Box3;if(a.setFromObject(o),a.containsPoint(n))return pickUpPowerUp(e),!0}}return!1},pickUpPowerUp=e=>{score+=1e3,1===e.userData.type?(batton.targetSize=LARGE_BATTON_ARC,batton.largeTimeout=30):2===e.userData.type&&(batton.shooterTimeout=5),pickUpPowerUpMusic()},detectBallFalls=e=>{module(e.position)>7&&(e.userData.outside=!0,balls=balls.filter(e=>!e.userData.outside),scene.remove(e),0===balls.length&&loseLife())},addPowerUp=(e,t)=>{const o=1===e?palette.segments[0]:palette.core,n=1===e?palette.core:palette.segments[0];addPowerUpMusic();const a=new T.MeshToonMaterial({color:o,wireframe:options.wireframeOn}),s=new T.IcosahedronGeometry(.5*BALL_RADIUS,1),i=new T.Mesh(s,a),r=t.clone().multiplyScalar(.99);i.position.set(r.x,r.y,r.z),i.userData.direction=t.clone(),i.userData.animationIndex=0,i.userData.type=e;const l=new THREE.TorusGeometry(BALL_RADIUS,.01,8,100),d=new T.MeshToonMaterial({color:n,wireframe:options.wireframeOn}),c=new THREE.Mesh(l,d);c.position.set(r.x,r.y,r.z),scene.add(c),allItems.push(c),i.userData.torus=c,scene.add(i),allItems.push(i),powerUps.push(i),powerUpsCooldown=POWER_UPS_COOLDOWN_FRAMES},hit=(e,t)=>{if(!t.userData.collisionsEnabled)return;t.userData.collisionsEnabled=!1,setTimeout(()=>{t.userData.collisionsEnabled=!0},100);const o=e.position.clone().normalize();let n;if(e.userData.isBatton)n="core",playBass(R.rch(lowerScale));else{score+=100,e.material.color=new T.Color(palette.hit);const a=Math.floor(e.userData.height.map(.1,3,0,higherScale.length-.001));e.userData.isPowerUp&&0===powerUpsCooldown?addPowerUp(e.userData.powerUpType,t.position.clone()):playReverb(higherScale[a]),setTimeout(()=>{e.userData.isFalling=!0},300),"outer"===(n=module(t.position)>module(e.position)?"outer":"core")?e.position.sub(o.multiplyScalar(.075)):e.position.add(o.multiplyScalar(.075))}if("core"==n){let e=t.position.clone().normalize();const{x:o,y:n}=t.position;let a=0,s=0;(batton.movingLeft||batton.movingRight||batton.slidingLeft||batton.slidingRight)&&(o>=0&&(a=n<=0?.2:-.2,s=.2),o<0&&(a=n>=0?-.2:.2,s=-.2),(batton.movingLeft||batton.slidingLeft)&&(a=-a,s=-s));const i=new T.Vector3(a,s,0),r=new T.Vector3(R.rbet(-.1,.1),R.rbet(-.1,.1),0);t.userData.direction=e.sub(i).negate().normalize().add(r).normalize()}else{const e=new T.Vector3(R.rbet(-.5,.5),R.rbet(-.5,.5),0);t.userData.direction=t.position.clone().normalize().add(e).normalize()}},onKeyDown=e=>{if(scoreboardVisible)return;const t=e.which;80==t&&(gameStatus!==GAME_STATUS.playing&&gameStatus!==GAME_STATUS.paused||togglePause()),37==t||65===t?(gameStatus===GAME_STATUS.playing&&(batton.movingLeft=!0,batton.slidingLeft=!1,batton.slidingRight=!1),gameStatus===GAME_STATUS.idle&&startGame()):39!=t&&68!==t||(gameStatus===GAME_STATUS.playing&&(batton.movingRight=!0,batton.slidingLeft=!1,batton.slidingRight=!1),gameStatus===GAME_STATUS.idle&&startGame())},onKeyUp=e=>{const t=e.which;37==t||65===t?batton.movingLeft=!1:39!=t&&68!==t||(batton.movingRight=!1)};let mouseX,mouseY;document.addEventListener("keydown",onKeyDown,!1),document.addEventListener("keyup",onKeyUp,!1);let latestAngles=[0,0,0,0];const addNewAngle=e=>{latestAngles[0]=latestAngles[1],latestAngles[1]=latestAngles[2],latestAngles[2]=latestAngles[3],latestAngles[3]=e},checkDirection=()=>{latestAngles[0]<latestAngles[1]&&latestAngles[1]<latestAngles[2]&&latestAngles[2]<latestAngles[3]?(batton.slidingRight=!0,batton.slidingLeft=!1):latestAngles[0]>latestAngles[1]&&latestAngles[1]>latestAngles[2]&&latestAngles[2]>latestAngles[3]?(batton.slidingLeft=!0,batton.slidingRight=!1):(batton.slidingLeft=!1,batton.slidingRight=!1)},onMouseMove=e=>{const{x:t,y:o}=renderer.domElement.getBoundingClientRect();if(mouseX=e.pageX-t-renderer.domElement.clientWidth/2,mouseY=e.pageY-o-renderer.domElement.clientHeight/2,gameStatus===GAME_STATUS.playing){const e=TAU-Math.atan2(mouseY,mouseX);batton.angle=e,addNewAngle(e),latestAngles[0]<latestAngles[1]&&latestAngles[1]<latestAngles[2]&&latestAngles[2]<latestAngles[3]?(batton.slidingRight=!0,batton.slidingLeft=!1):latestAngles[0]>latestAngles[1]&&latestAngles[1]>latestAngles[2]&&latestAngles[2]>latestAngles[3]?(batton.slidingLeft=!0,batton.slidingRight=!1):(batton.slidingLeft=!1,batton.slidingRight=!1)}},cooldownPowerUps=()=>{powerUpsCooldown>0&&powerUpsCooldown--};renderer.domElement.onmousemove=onMouseMove,renderer.domElement.ontouchmove=onMouseMove,renderer.domElement.onclick=(()=>{gameStatus===GAME_STATUS.idle&&startGame()});const animate=()=>{gameStatus===GAME_STATUS.playing&&(moveBalls(),moveBatton(),movePowerUps(),buildBatton(),playingFrames%20&&(gameTime+=clock.getDelta(),boardVisible&&(document.getElementById("cc_time").innerHTML=formatTime(gameTime),document.getElementById("cc_score").innerHTML=score.toLocaleString())),playingFrames++),gameStatus!==GAME_STATUS.playing&&gameStatus!==GAME_STATUS.idle||(rotateLayers(),fallCubes()),gameStatus===GAME_STATUS.starting&&gameStartAnimation(),gameStatus===GAME_STATUS.gameOver&&dimScreen(),gameStatus===GAME_STATUS.victory&&(rotateLayers(),lightScreen()),powerUpsCooldown>0&&powerUpsCooldown--};function render(){animate(),renderer.render(scene,camera),requestAnimationFrame(render,100)}render(),appendStyles();