const Painting_A_Wave='\n"Painting a wave requires no system,"\nThe painter said, painting a wave.\n"Systems may get you flotsam and jetsam,\nSeaweed and so forth. But never a wave."\n - Howard Moss';S=Uint32Array.from([0,1,s=t=2,3].map(e=>parseInt(tokenData.hash.substr(8*e+2,8),16))),R=(e=>(t=S[3],S[3]=S[2],S[2]=S[1],S[1]=s=S[0],t^=t<<11,S[0]^=t^t>>>8^s>>>19,S[0]/2**32));const pp1=[];pp1.push([0,0,0,0,0,100]),pp1.push([249,100,50,0,0,100,0,100,50,0,0,100]),pp1.push([59,100,50,175,100,50,59,100,50,175,100,50,59,100,50,175,100,50]),pp1.push([175,100,50,125,100,64,300,100,64]),pp1.push([321,100,50,24,100,22,32,100,50]),pp1.push([321,100,50,24,100,22,32,100,50]),pp1.push([201,100,50,264,100,22,272,100,50]),pp1.push([4,79,27,29,59,18,15,75,50]),pp1.push([4,79,27,29,59,18,15,75,50]),pp1.push([359,100,50,325,100,37,352,100,6]),pp1.push([5,90,62,19,90,66,170,100,99,332,96,74,330,98,43]);const pp2=[];pp2.push([36,99,56,50,100,51,92,92,57,189,100,53,223,100,73,300,100,71]),pp2.push([351,88,62,353,82,63,355,77,65,359,67,67,4,59,67,11,48,67,22,40,66,36,30,66,56,23,66,78,26,68]),pp2.push([53,100,67,23,97,59,62,48,46,307,4,34]),pp2.push([357,96,60,38,96,78,0,0,90,190,60,50,198,64,38,214,60,31,220,54,25]),pp2.push([295,98,78,193,92,79,152,100,73]),pp2.push([131,62,74,141,66,42,134,39,20]);let pp3=[];const calculatePalette=(e,t,i)=>{let l=e.paletteUse[t],s=[];p5.colorMode(HSB,360);for(let e=0;e<l.length;e+=3)s.push([l[e],l[e+1],l[e+2]]);let o=Math.floor(i/2)+1,a=[];for(let e=0;e<s.length-1;e++){const t=p5.color(s[e]),i=p5.color(s[e+1]);for(j=0;j<1;j+=.1)a.push(p5.lerpColor(t,i,j))}a.push(p5.color(s[s.length-1]));let n=[];for(var p=0;p<o;p++)n.push(a[Math.floor(p/Math.max(1,o-1)*(a.length-1))]);return n=n.map(e=>`hsl(${Math.floor(e._getHue())}, ${Math.floor(e._getSaturation())}%, ${Math.floor(e._getBrightness())}%)`),secondHalf=JSON.parse(JSON.stringify(n)),secondHalf.shift(),secondHalf.reverse(),i%2==0&&secondHalf.shift(),[...n,...secondHalf]},getPalette=(e,t)=>{const l=JSON.parse(JSON.stringify(e.palRandoms));let s=l.pop(),o=null;e.hasSmall?(o=calculatePalette(e,e.paletteIndex,e.lines/2),o=[...o,...o]):o=calculatePalette(e,e.paletteIndex,e.lines);let a=JSON.parse(JSON.stringify(o));if("Flat"!==e.fill){let n=1;e.hasSmall&&(n=.5);let p=null,r=Math.floor(e.lines/2)+1,c=Math.floor(s*r*n),d=c,f=0;for(;d===c&&f<10;)s=l.pop(),d=Math.floor(s*r*n),f++;c>d&&([c,d]=[d,c]),"Single Grad"===e.fill&&((p=t.ctx.createLinearGradient(0,0,0,t.size)).addColorStop(0,o[c]),p.addColorStop(1,o[d])),"Zap Grad"===e.fill&&((p=t.ctx.createLinearGradient(0,0,0,t.size)).addColorStop(0,o[c]),p.addColorStop(.5,o[d]),p.addColorStop(1,o[c])),"Metallic"===e.fill&&((p=t.ctx.createLinearGradient(.333*t.size,0,.666*t.size,t.size)).addColorStop(0,"#FFFFFF"),p.addColorStop(1,"#000000"));const h=(new Date).getTime()-e.startTime,S=Math.floor(h/10%360),m=[0,60,120,180,240,300,360].map(e=>((e-=S)<0&&(e+=360),e));if("Rainbow"===e.fill&&((p=t.ctx.createLinearGradient(0,0,0,t.size)).addColorStop(0,`hsl(${m[0]}, 100%, 50%)`),p.addColorStop(1/6,`hsl(${m[1]}, 100%, 50%)`),p.addColorStop(1/6*2,`hsl(${m[2]}, 100%, 50%)`),p.addColorStop(.5,`hsl(${m[3]}, 100%, 50%)`),p.addColorStop(1/6*4,`hsl(${m[4]}, 100%, 50%)`),p.addColorStop(1/6*5,`hsl(${m[5]}, 100%, 50%)`),p.addColorStop(1,`hsl(${m[0]}, 100%, 50%)`)),"Stripes"===e.fill||"Ninja"===e.fill)return"Stripes"===e.fill?o:["hsl(0, 0%, 100%)"];{const t=Math.ceil(e.lines/8);for(i=0;i<t;i++){s=l.pop();let e=Math.floor(s*(d-c))+d-1;0===e&&(e=1),9===i&&(e=1);const t=o[e];a=o.map(e=>e===t?p:e)}}}else a=[a[0]];return a};let scaled=!1;const resizeCanvas=e=>{const t={};Object.entries(document.getElementsByTagName("canvas")).forEach(e=>e[1].remove());const i=document.createElement("canvas");for(i.setAttribute("id","canv"),document.body.appendChild(i),t.canvas=document.getElementById("canv"),t.ctx=t.canvas.getContext("2d"),t.def=2400,t.size=Math.min(window.innerWidth,window.innerHeight),t.canvas.width=t.size*devicePixelRatio,t.canvas.height=t.size*devicePixelRatio,t.canvas.style.width=t.size+"px",t.canvas.style.height=t.size+"px",t.sizeMod=t.size/t.def,scaled||t.ctx.scale(devicePixelRatio,devicePixelRatio),t.mkr=18*t.sizeMod*.8,s=260;s>0;s-=20)t.size<=s&&(t.mkr*=.95);return t.tileSize=t.size/e.tiles,t.step=t.tileSize/e.lines,t.stepOffset=t.step/2,t.midPoint=t.size/2-t.tileSize/2,t.cornerDistance=2*Math.pow(t.midPoint,2),t.midPoint=t.size/2,t},makeFeatures=e=>{const t={needsAnimating:!1,palRandoms:[]};for(let e=0;e<275;e++)t.palRandoms.push(R());const i=R(),l=R();R();t.tiles=Math.floor((i+l/2)/1.5*8+4),t.tileBoost=0,R()<.1&&(t.tileBoost+=2),R()<.1&&(t.tileBoost+=4),t.tiles+=t.tileBoost,t.lines=Math.floor(9-(i+l)/2*14)+8,t.linesBoost=0,R()<.1&&t.linesBoost--,R()<.1&&(t.linesBoost-=2),R()<.1&&t.linesBoost++,R()<.1&&(t.linesBoost+=2),t.lines+=t.linesBoost,t.tiles>=16&&t.lines--,t.tiles>17&&t.lines>5&&(t.lines=6),t.tiles+t.lines>19&&(t.lines-=4),t.lines<1&&(t.lines=1),chance=.5;R();if(t.fill="Flat",t.lines>5&&(R()<.75&&(t.fill="Stripes"),R()<.13&&(t.fill="Zap Grad"),R()<.48&&t.lines<8&&(t.fill="Single Grad"),R()<.075&&(t.fill="Metallic"),R()<.15&&6!==t.lines&&10!==t.lines&&(t.fill="Rainbow")),t.pal=1,"Flat"!==t.fill?R()<.25&&t.lines>=6&&(t.pal=2):(t.pal=3,(pp3=[]).push([Math.floor(360*R()),87,77]),pp3.push([Math.floor(360*R()),87,77]),pp3.push([Math.floor(360*R()),100,58])),t.paletteUse=pp1,2===t.pal&&(t.paletteUse=pp2),3===t.pal&&(t.paletteUse=pp3),t.paletteIndex=Math.floor(R()*t.paletteUse.length),t.lines<=2&&R()>.66)t.pal=1,t.paletteUse=pp1,t.paletteIndex=0,t.fill="Ninja";else if("Flat"===t.fill||t.lines<5||"Metallic"===t.fill||"Single Grad"===t.fill)for(;0===t.paletteIndex;)t.paletteIndex=Math.floor(R()*t.paletteUse.length);if(t.hasSmall=0,t.hasBig=0,R()>.2&&(t.hasBig=1),t.lines%2==0&&R()>.2&&(t.hasSmall=1),t.format="Normal",(t.hasBig>0||t.hasSmall>0)&&(R()<.29&&(t.format="Outer"),R()<.21&&(t.format="Middle"),R()<.14&&(t.format="Bottom-up"),R()<.09&&(t.format="Top-down")),"Flat"===t.fill){for(;0===t.hasBig&&0===t.hasSmall;)R()>.5&&(t.hasBig=1),t.lines%2==0&&R()>.5&&(t.hasSmall=1);for(;"Normal"===t.format;)R()<.29&&(t.format="Outer"),R()<.21&&(t.format="Middle"),R()<.14&&(t.format="Bottom-up"),R()<.09&&(t.format="Top-down")}return t.tiles<8&&(t.hasBig=0,"Flat"===t.fill&&t.lines%2==0&&(t.hasSmall=1)),t.ticktock="None",0===t.hasBig&&0===t.hasSmall&&"Rainbow"!==t.fill&&("Flat"===t.fill||R()<.2)&&(t.ticktock="Chaser1",R()<.51&&(t.ticktock="Chess"),R()<.21&&(t.ticktock="Wipe"),R()<.21&&(t.ticktock="Chaser4"),R()<.11&&(t.ticktock="Sweep")),t.paletteSeed=R(),t.lastTick=(new Date).getTime(),t.tickSpeed=100,t.tick=0,"Rainbow"!==t.fill&&"None"===t.ticktock||(t.needsAnimating=!0),t},drawTile=(e,t,i,a,n,p,r,c,d,f)=>{o=n/(2*p),st=n/p,pi=Math.PI,s=0,i&&!a&&(s=1),i&&a&&(s=2),!i&&a&&(s=3),s1=.5*s*pi,s2=.5*(s+1)*pi;const h={0:{0:(e,t)=>[[e,0],[0,t]],1:(e,t)=>[[0,n-e],[t,n]]},1:{0:(e,t)=>[[n,e],[n-e,0]],1:(e,t)=>[[n-e,n],[n,n-t]]}};for(r.lineCap="round",l=p-1;l>=0;l--){r.fillStyle=c[l%c.length],r.strokeStyle=c[l%c.length],r.lineWidth=4*f;const s=l*st+o,p=(l-1)*st+o,S=h[i][a](s,p)[0],m=h[i][a](s,p)[1];r.lineCap="round",l>0&&(r.beginPath(),r.moveTo(e+S[0],t+S[1]),r.arc(e+n*i,t+n*a,s,s1,s2),r.lineTo(e+m[0],t+m[1]),r.arc(e+n*i,t+n*a,p,s2,s1,!0),r.closePath(),r.stroke(),r.fill()),r.lineCap="round",r.lineWidth=d,r.strokeStyle="black",r.beginPath(),r.arc(e+n*i,t+n*a,s,s1,s2),r.stroke()}},drawStraight=(e,t,i,s,o,a,n,p,r)=>{const c=s/(2*o),d=s/o;for(a.lineCap="round",l=o-1;l>=0;l--){a.fillStyle=n[l%n.length],a.strokeStyle=n[l%n.length],a.lineWidth=4*r;l;let o=p2x=l*d+c,f=p2xp=(l-1)*d+c,h=p1yp=0,S=p2yp=s;i&&([o,h,p2x,S]=[h,o,S,p2x]),i&&([f,p1yp,p2xp,p2yp]=[p1yp,f,p2yp,p2xp]),l>0&&(a.beginPath(),a.moveTo(e+o,t+h),a.lineTo(e+p2x,t+S),a.lineTo(e+p2xp,t+p2yp),a.lineTo(e+f,t+p1yp),a.closePath(),a.stroke(),a.fill()),a.lineWidth=p,a.strokeStyle="black",a.beginPath(),a.moveTo(e+o,t+h),a.lineTo(e+p2x,t+S),a.stroke()}},getPos=(e,t,i)=>({left:i.tileSize*e,right:i.tileSize*(e+1),top:i.tileSize*t,bottom:i.tileSize*(t+1)}),makeTileHolders=(e,t)=>{const l=(new Date).getTime();let s=200;"Chaser1"!==t.ticktock&&"Chaser4"!==t.ticktock||(s=1e3);let o=t.tiles*s+4e3;"Chaser1"===t.ticktock&&(o=t.tiles*t.tiles*s);const a={};for(let n=0;n<t.tiles;n++)for(let p=0;p<t.tiles;p++){pos=getPos(p,n,e),d=R(),index=`${p}:${n}`,index2=`${p+1}:${n}`,index3=`${p}:${n+1}`,index4=`${p+1}:${n+1}`,scM=1,scM2=1;const r=.25;if(!a[index]||a[index]&&"skip"in a[index][0]&&!0!==a[index][0].skip){let e=.7-R(),c=(.7-R())*r*t.hasBig,d=(.7-R())*scM2*((t.lines+1)%2);"Top-down"===t.format&&(d=1-(c=(t.tiles-n)/t.tiles*t.hasBig)),"Bottom-up"===t.format&&(d=1-(c=n/t.tiles*t.hasBig)),"Middle"===t.format&&(d=(t.tiles-1-n)/(t.tiles-1)*2-1,n>=t.tiles/2&&(d=n/(t.tiles-1)*2-1),c=1-((t.tiles-1-n)/(t.tiles-1)*2-1),n>=t.tiles/2&&(c=1-(n/(t.tiles-1)*2-1))),"Outer"===t.format&&(c=(t.tiles-1-n)/(t.tiles-1)*2-1,n>=t.tiles/2&&(c=n/(t.tiles-1)*2-1),d=1-((t.tiles-1-n)/(t.tiles-1)*2-1),n>=t.tiles/2&&(d=1-(n/(t.tiles-1)*2-1))),c<.1&&(c=.1),c>.9&&(c=.9),d<.1&&(d=.1),d>.9&&(d=.9),e<.1&&(e=.1),e>.9&&(e=.9),c*=t.hasBig,d*=t.hasSmall;let f=!1,h=!1,S=!1,m=[0,0];R()<d&&t.lines>1&&(S=!0),!(p<t.tiles-1&&n<t.tiles-1&&R()<c)||a[index2]&&a[index2][0].skip||a[index3]&&a[index3][0].skip||a[index4]&&a[index4][0].skip||S||(h=!0);let u={goBig:h,goSmall:S,sizeMod:1,subOffset:m};S&&(u.sizeMod=.5),h&&(u.sizeMod=2);let g=[],x=S?4:1;if("Sweep"===t.ticktock&&(u.nextCycle=o,u.nextAction=l+n*s*2+2*s),"Wipe"===t.ticktock&&(u.nextCycle=o,u.nextAction=l+p*s*2+2*s),"Chaser1"===t.ticktock&&(u.nextCycle=o,u.nextAction=l+(n*t.tiles+p)*s+s+2e3),"Chaser4"===t.ticktock&&(u.nextCycle=o,u.nextAction=l+(n*t.tiles+p)*s+s+2e3),"Chess"===t.ticktock&&(u.nextCycle=2e3,u.nextAction=l+2e3,(p+n)%2==0&&(u.nextAction+=1e3)),!f)for(i=0;i<x;i++){const t=JSON.parse(JSON.stringify(u));if(R()>=e){t.type=2;const e=R();e<.75&&(t.type=3),e<.5&&(t.type=4),e<.25&&(t.type=5)}else t.type=-1,R()<.5&&(t.type=1);1===i&&(t.subOffset=[.5,0]),2===i&&(t.subOffset=[0,.5]),3===i&&(t.subOffset=[.5,.5]),g.push(t)}a[index]=g,g[0].goBig&&(a[`${p+1}:${n}`]=a[`${p}:${n+1}`]=a[`${p+1}:${n+1}`]=[{skip:!0}])}}return a},drawImage=(e,t,i)=>{const l=(new Date).getTime();for(let s=0;s<t.tiles;s++)for(let o=0;o<t.tiles;o++){const a=i[`${o}:${s}`];a[0].skip||a.forEach(i=>{i.nextAction&&l>i.nextAction&&(i.type<2&&(i.type*=-1),i.type>1&&i.type++,i.type>5&&(i.type=2),i.nextAction+=i.nextCycle);getPos(o,s,e);if(i.type>1){let l=0,a=0;3!==i.type&&4!==i.type||(l=1),4!==i.type&&5!==i.type||(a=1),drawTile(e.tileSize*o+i.subOffset[0]*e.tileSize,e.tileSize*s+i.subOffset[1]*e.tileSize,l,a,e.tileSize*i.sizeMod,t.lines*i.sizeMod,e.ctx,t.colours,e.mkr,e.sizeMod),drawTile(e.tileSize*o+i.subOffset[0]*e.tileSize,e.tileSize*s+i.subOffset[1]*e.tileSize,+!l,+!a,e.tileSize*i.sizeMod,t.lines*i.sizeMod,e.ctx,t.colours,e.mkr,e.sizeMod)}i.type<2&&(drawStraight(e.tileSize*o+i.subOffset[0]*e.tileSize,e.tileSize*s+i.subOffset[1]*e.tileSize,1===i.type,e.tileSize*i.sizeMod,t.lines*i.sizeMod,e.ctx,t.colours,e.mkr,e.sizeMod),drawStraight(e.tileSize*o+i.subOffset[0]*e.tileSize,e.tileSize*s+i.subOffset[1]*e.tileSize,1!==i.type,e.tileSize*i.sizeMod,t.lines*i.sizeMod,e.ctx,t.colours,e.mkr,e.sizeMod))})}},drawTheThing=(e,t)=>{const i=gTarget;e.tick++,e.colours=getPalette(e,i),i.ctx.globalCompositeOperation="source-over",i.ctx.fillStyle=e.colours[0],i.ctx.beginPath(),i.ctx.rect(0,0,i.size,i.size),i.ctx.fill(),i.ctx.lineWidth=i.mkr,drawImage(i,e,t),"Ninja"===e.fill&&(i.ctx.globalCompositeOperation="difference",i.ctx.fillStyle="#FFFFFF",i.ctx.beginPath(),i.ctx.rect(0,0,i.size,i.size),i.ctx.fill()),e.needsAnimating&&window.requestAnimationFrame(()=>{drawTheThing(e,t)})};let features,target,gTarget,tileHolders=null;p5=new p5,counter=0,window.addEventListener("DOMContentLoaded",function(){(features=makeFeatures(tokenData.hash)).startTime=(new Date).getTime(),gTarget=resizeCanvas(features),tileHolders=makeTileHolders(gTarget,features);(new Date).getTime();window.requestAnimationFrame(()=>{drawTheThing(features,tileHolders,!1)}),window.onresize=(()=>{gTarget=resizeCanvas(features),features.needsAnimating||window.requestAnimationFrame(()=>{drawTheThing(features,tileHolders,!1)})})});