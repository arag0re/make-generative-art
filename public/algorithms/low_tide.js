function Voronoi(){this.vertices=null,this.edges=null,this.cells=null,this.toRecycle=null,this.beachsectionJunkyard=[],this.circleEventJunkyard=[],this.vertexJunkyard=[],this.edgeJunkyard=[],this.cellJunkyard=[]}function edge_centre(e){let t={};return t.x=e.edge.va.x-(e.edge.va.x-e.edge.vb.x)/2,t.y=e.edge.va.y-(e.edge.va.y-e.edge.vb.y)/2,t}function vertex_scale(e,t){let i={},r=dist2D(e.x,e.y,t.x,t.y)/offset;return i.x=e.x-(e.x-t.x)/r,i.y=e.y-(e.y-t.y)/r,i}function dist2D(e,t,i,r){return Math.sqrt((e-i)**2+(t-r)**2)}function setRandoms(e,t,i,r){for(var s=[],o=0;o<r;o++){var a,n=R.random_between(0,e),l=R.random_between(0,t),c=0;if(i>0)do{a=!1,n=R.random_between(0,e),l=R.random_between(0,t);for(var h=0;h<s.length;h++)dist2D(n,l,s[h].x,s[h].y)<i&&(a=!0);c++}while(1==a&&c<=500);s.push({x:n,y:l})}return s}function castVoronoi(e){for(var t=0;t<vcells[e].halfedges.length;t++)if(!(dist2D(vcells[e].halfedges[t].edge.va.x,vcells[e].halfedges[t].edge.va.y,vcells[e].halfedges[t].edge.vb.x,vcells[e].halfedges[t].edge.vb.y)<canvasSize/20))if(dist2D(vcells[e].halfedges[(t+1)%vcells[e].halfedges.length].edge.va.x,vcells[e].halfedges[(t+1)%vcells[e].halfedges.length].edge.va.y,vcells[e].halfedges[(t+1)%vcells[e].halfedges.length].edge.vb.x,vcells[e].halfedges[(t+1)%vcells[e].halfedges.length].edge.vb.y)>canvasSize/20)vertex(vertex_scale(edge_centre(vcells[e].halfedges[t]),cursite,cellscale).x,vertex_scale(edge_centre(vcells[e].halfedges[t]),cursite,cellscale).y*cor),quadraticVertex(vertex_scale(curvert[t],cursite,cellscale).x,vertex_scale(curvert[t],cursite,cellscale).y*cor,vertex_scale(edge_centre(vcells[e].halfedges[(t+1)%vcells[e].halfedges.length]),cursite,cellscale).x,vertex_scale(edge_centre(vcells[e].halfedges[(t+1)%vcells[e].halfedges.length]),cursite,cellscale).y*cor);else{let i=0;for(;dist2D(vcells[e].halfedges[(t+i+1)%vcells[e].halfedges.length].edge.va.x,vcells[e].halfedges[(t+i+1)%vcells[e].halfedges.length].edge.va.y,vcells[e].halfedges[(t+i+1)%vcells[e].halfedges.length].edge.vb.x,vcells[e].halfedges[(t+i+1)%vcells[e].halfedges.length].edge.vb.y)<=canvasSize/20;)i+=1;vertex(vertex_scale(edge_centre(vcells[e].halfedges[t]),cursite,cellscale).x,vertex_scale(edge_centre(vcells[e].halfedges[t]),cursite,cellscale).y*cor),quadraticVertex(vertex_scale(curvert[(t+i)%vcells[e].halfedges.length],cursite,cellscale).x,vertex_scale(curvert[(t+i)%vcells[e].halfedges.length],cursite,cellscale).y*cor,vertex_scale(edge_centre(vcells[e].halfedges[(t+i+1)%vcells[e].halfedges.length]),cursite,cellscale).x,vertex_scale(edge_centre(vcells[e].halfedges[(t+i+1)%vcells[e].halfedges.length]),cursite,cellscale).y*cor)}}function castVertexes(e){check={x:vcells[e].halfedges[vcells[e].halfedges.length-1].edge.va.x,y:vcells[e].halfedges[vcells[e].halfedges.length-1].edge.vb.x},cursite=vcells[e].site,curvert=[];for(var t=0;t<vcells[e].halfedges.length;t++)vert={},vcells[e].halfedges[t].edge.va.x!=check.x&&vcells[e].halfedges[t].edge.va.x!=check.y?(check.x=vcells[e].halfedges[t].edge.va.x,check.y=vcells[e].halfedges[t].edge.va.y,vert.x=vcells[e].halfedges[t].edge.va.x,vert.y=vcells[e].halfedges[t].edge.va.y):(check.x=vcells[e].halfedges[t].edge.vb.x,check.y=vcells[e].halfedges[t].edge.vb.y,vert.x=vcells[e].halfedges[t].edge.vb.x,vert.y=vcells[e].halfedges[t].edge.vb.y),curvert.push(vert)}function frame(){erase(),beginShape(),vertex(0,0),vertex(canvasSize,0),vertex(canvasSize,canvasSize),vertex(0,canvasSize),beginContour(),vertex(canvasSize/2,canvasSize/100),quadraticVertex(framecor,framecor,canvasSize/100,canvasSize/2),quadraticVertex(framecor,canvasSize-framecor,canvasSize/2,canvasSize-canvasSize/100),quadraticVertex(canvasSize-framecor,canvasSize-framecor,canvasSize-canvasSize/100,canvasSize/2),quadraticVertex(canvasSize-framecor,framecor,canvasSize/2,canvasSize/100),endContour(),endShape(CLOSE),noErase()}function Particle(){function e(e,t,i,r,s,o,a,n){t.mult(canvasSize/80*s),i.mult(canvasSize/400*s),r.mult(canvasSize/400*s),push(),strokeWeight(canvasSize/300*s),translate(e.x,e.y),line(i.x+o+a,i.y+o+n,t.x+o+a,t.y+o+n),line(r.x+o+a,r.y+o+n,t.x+o+a,t.y+o+n),pop(),circle(e.x+o+a,e.y+o+n,canvasSize/400*s)}function t(e,t,i,r,s,o,a,n){t.mult(canvasSize/45*s),i.mult(canvasSize/220*s),r.mult(canvasSize/220*s),push(),noStroke(),translate(e.x,e.y),beginShape(),vertex(o+a,o+n),vertex(.65*t.x+i.x+o+a,.65*t.y+i.y+o+n),vertex(t.x+o+a,t.y+o+n),vertex(.65*t.x+r.x+o+a,.65*t.y+r.y+o+n),endShape(CLOSE),pop()}function i(e,t,i,r,s,o,a,n){t.mult(canvasSize/45*s),i.mult(canvasSize/220*s),r.mult(canvasSize/220*s),push(),noStroke(),translate(e.x,e.y),beginShape(),vertex(o+a,o+n),vertex(.75*t.x+i.x+o+a,.75*t.y+i.y+o+n),vertex(.75*t.x+r.x+o+a,.75*t.y+r.y+o+n),endShape(CLOSE),beginShape(),vertex(t.x+o+a,t.y+o+n),vertex(.7*t.x+.5*i.x+o+a,.7*t.y+.5*i.y+o+n),vertex(.7*t.x+.5*r.x+o+a,.7*t.y+.5*r.y+o+n),endShape(CLOSE),pop()}function r(e,t,i,r,s,o,a,n){t.mult(canvasSize/40*s),i.mult(canvasSize/220*s),r.mult(canvasSize/220*s),push(),noStroke(),translate(e.x,e.y),beginShape(),vertex(.3*i.x+o+a,.3*i.y+o+n),vertex(.35*t.x+i.x+o+a,.35*t.y+i.y+o+n),vertex(.35*t.x+r.x+o+a,.35*t.y+r.y+o+n),vertex(.3*r.x+o+a,.3*r.y+o+n),endShape(CLOSE),beginShape(),vertex(.15*t.x+o+a,.15*t.y+o+n),vertex(.6*t.x+i.x+o+a,.6*t.y+i.y+o+n),vertex(.6*t.x+r.x+o+a,.6*t.y+r.y+o+n),endShape(CLOSE),beginShape(),vertex(t.x+o+a,t.y+o+n),vertex(.55*t.x+.3*i.x+o+a,.55*t.y+.3*i.y+o+n),vertex(.55*t.x+.3*r.x+o+a,.55*t.y+.3*r.y+o+n),endShape(CLOSE),pop()}function s(e,t,i,r,s,o,a,n){t.mult(canvasSize/50*s),i.mult(canvasSize/220*s),r.mult(canvasSize/220*s),push(),translate(e.x,e.y),strokeWeight(canvasSize/400*s),line(.6*t.x+o+a,.6*t.y+o+n,t.x+o+a,t.y+o+n),noStroke(),beginShape(),curveVertex(i.x+.3*t.x+o+a,i.y+.3*t.y+o+n),curveVertex(o+a,o+n),curveVertex(r.x+.3*t.x+o+a,r.y+.3*t.y+o+n),curveVertex(.6*t.x+o+a,.6*t.y+o+n),curveVertex(i.x+.3*t.x+o+a,i.y+.3*t.y+o+n),curveVertex(o+a,o+n),curveVertex(r.x+.3*t.x+o+a,r.y+.3*t.y+o+n),endShape(),pop()}function o(e,t,i,r,s,o,a,n){t.mult(canvasSize/60*s),i.mult(canvasSize/160*s),r.mult(canvasSize/160*s),push(),noStroke(),translate(e.x,e.y),beginShape(),vertex(o+a,o+n),vertex(.4*t.x+i.x+o+a,.4*t.y+i.y+o+n),vertex(.8*t.x+o+a,.8*t.y+o+n),vertex(.4*t.x+r.x+o+a,.4*t.y+r.y+o+n),endShape(CLOSE),beginShape(),vertex(.7*t.x+o+a,.7*t.y+o+n),vertex(.85*t.x+.5*i.x+o+a,.85*t.y+.5*i.y+o+n),vertex(t.x+o+a,t.y+o+n),vertex(.85*t.x+.5*r.x+o+a,.85*t.y+.5*r.y+o+n),endShape(CLOSE),pop()}this.pos=createVector(R.random_between(0, canvasSize), R.random_between(0, canvasSize)),this.privpos=createVector(0,0),this.vel=createVector(0,0),this.acc=createVector(0,0),this.maxspeed=canvasSize/400,this.body=createVector(0,0),this.bodyl=createVector(0,0),this.bodyr=createVector(0,0),this.update=function(e){this.vel.add(this.acc),this.vel.limit(this.maxspeed*e),this.pos.add(this.vel),this.acc.mult(0)},this.applyForce=function(e,t){this.acc.add(e),this.acc.rotate(t)},this.show=function(a,n,l){this.body.mult(0),this.body.add(createVector(this.privpos.x-this.pos.x,this.privpos.y-this.pos.y)),this.bodyl.mult(0),this.bodyr.mult(0),this.body.normalize(),this.bodyl.add(this.body),this.bodyl.rotate(90),this.bodyr.add(this.body),this.bodyr.rotate(-90),stroke(n),fill(n),l<25?e(this.pos,this.body,this.bodyl,this.bodyr,a,0,0,0):l<40?o(this.pos,this.body,this.bodyl,this.bodyr,a,0,0,0):l<55?i(this.pos,this.body,this.bodyl,this.bodyr,a,0,0,0):l<70?r(this.pos,this.body,this.bodyl,this.bodyr,a,0,0,0):l<85?s(this.pos,this.body,this.bodyl,this.bodyr,a,0,0,0):t(this.pos,this.body,this.bodyl,this.bodyr,a,0,0,0)},this.castShadow=function(a,n,l,c){var h=0,v=0;this.body.normalize(),this.bodyl.normalize(),this.bodyr.normalize(),this.pos.x+n>fieldSize-canvOffset&&(h=-fieldSize),this.pos.y+n>fieldSize-canvOffset&&(v=-fieldSize),stroke(l),fill(l),c<25?e(this.pos,this.body,this.bodyl,this.bodyr,a,n,h,v):c<40?o(this.pos,this.body,this.bodyl,this.bodyr,a,n,h,v):c<55?i(this.pos,this.body,this.bodyl,this.bodyr,a,n,h,v):c<70?r(this.pos,this.body,this.bodyl,this.bodyr,a,n,h,v):c<85?s(this.pos,this.body,this.bodyl,this.bodyr,a,n,h,v):t(this.pos,this.body,this.bodyl,this.bodyr,a,n,h,v)},this.edges=function(){this.pos.x>fieldSize-canvOffset&&(this.pos.x=-canvOffset),this.pos.x<-canvOffset&&(this.pos.x=fieldSize-canvOffset),this.pos.y>fieldSize-canvOffset&&(this.pos.y=-canvOffset),this.pos.y<-canvOffset&&(this.pos.y=fieldSize-canvOffset)},this.follow=function(e,t){var i=floor((this.pos.x+canvOffset)/(fieldSize/vscale)),r=floor((this.pos.y+canvOffset)/(fieldSize/vscale));this.privpos.mult(0),this.privpos.add(this.pos);var s=e[i+r*vcols];this.applyForce(s,t)}}function genstarfish(e){function t(e){beginShape();for(let t=0;t<360;t+=r){let i=sfx+e+cos(t+sfrotate)*sfsize/2,r=sfy+e+sin(t+sfrotate)*sfsize/2;vertex(i,r),i=sfx+e+cos(t+s+sfrotate)*sfsize/3.5,r=sfy+e+sin(t+s+sfrotate)*sfsize/3.5,vertex(i,r)}endShape(CLOSE)}push(),angleMode(DEGREES),colorMode(HSB);var i=color((hue(e)+230)%360,saturation(e),brightness(e)+20);colorMode(RGB);let r=72,s=r/2;strokeWeight(canvasSize/80),strokeJoin(ROUND),stroke(c2),fill(c2),t(canvasSize/250),stroke(i),fill(i),t(0),pop()}Voronoi.prototype.reset=function(){if(this.beachline||(this.beachline=new this.RBTree),this.beachline.root)for(var e=this.beachline.getFirst(this.beachline.root);e;)this.beachsectionJunkyard.push(e),e=e.rbNext;this.beachline.root=null,this.circleEvents||(this.circleEvents=new this.RBTree),this.circleEvents.root=this.firstCircleEvent=null,this.vertices=[],this.edges=[],this.cells=[]},Voronoi.prototype.sqrt=Math.sqrt,Voronoi.prototype.abs=Math.abs,Voronoi.prototype.ε=Voronoi.ε=1e-9,Voronoi.prototype.invε=Voronoi.invε=1/Voronoi.ε,Voronoi.prototype.equalWithEpsilon=function(e,t){return this.abs(e-t)<1e-9},Voronoi.prototype.greaterThanWithEpsilon=function(e,t){return e-t>1e-9},Voronoi.prototype.greaterThanOrEqualWithEpsilon=function(e,t){return t-e<1e-9},Voronoi.prototype.lessThanWithEpsilon=function(e,t){return t-e>1e-9},Voronoi.prototype.lessThanOrEqualWithEpsilon=function(e,t){return e-t<1e-9},Voronoi.prototype.RBTree=function(){this.root=null},Voronoi.prototype.RBTree.prototype.rbInsertSuccessor=function(e,t){var i,r,s;if(e){if(t.rbPrevious=e,t.rbNext=e.rbNext,e.rbNext&&(e.rbNext.rbPrevious=t),e.rbNext=t,e.rbRight){for(e=e.rbRight;e.rbLeft;)e=e.rbLeft;e.rbLeft=t}else e.rbRight=t;i=e}else this.root?(e=this.getFirst(this.root),t.rbPrevious=null,t.rbNext=e,e.rbPrevious=t,e.rbLeft=t,i=e):(t.rbPrevious=t.rbNext=null,this.root=t,i=null);for(t.rbLeft=t.rbRight=null,t.rbParent=i,t.rbRed=!0,e=t;i&&i.rbRed;)i===(r=i.rbParent).rbLeft?(s=r.rbRight)&&s.rbRed?(i.rbRed=s.rbRed=!1,r.rbRed=!0,e=r):(e===i.rbRight&&(this.rbRotateLeft(i),i=(e=i).rbParent),i.rbRed=!1,r.rbRed=!0,this.rbRotateRight(r)):(s=r.rbLeft)&&s.rbRed?(i.rbRed=s.rbRed=!1,r.rbRed=!0,e=r):(e===i.rbLeft&&(this.rbRotateRight(i),i=(e=i).rbParent),i.rbRed=!1,r.rbRed=!0,this.rbRotateLeft(r)),i=e.rbParent;this.root.rbRed=!1},Voronoi.prototype.RBTree.prototype.rbRemoveNode=function(e){e.rbNext&&(e.rbNext.rbPrevious=e.rbPrevious),e.rbPrevious&&(e.rbPrevious.rbNext=e.rbNext),e.rbNext=e.rbPrevious=null;var t,i,r=e.rbParent,s=e.rbLeft,o=e.rbRight;if(t=s?o?this.getFirst(o):s:o,r?r.rbLeft===e?r.rbLeft=t:r.rbRight=t:this.root=t,s&&o?(i=t.rbRed,t.rbRed=e.rbRed,t.rbLeft=s,s.rbParent=t,t!==o?(r=t.rbParent,t.rbParent=e.rbParent,e=t.rbRight,r.rbLeft=e,t.rbRight=o,o.rbParent=t):(t.rbParent=r,r=t,e=t.rbRight)):(i=e.rbRed,e=t),e&&(e.rbParent=r),!i)if(e&&e.rbRed)e.rbRed=!1;else{var a;do{if(e===this.root)break;if(e===r.rbLeft){if((a=r.rbRight).rbRed&&(a.rbRed=!1,r.rbRed=!0,this.rbRotateLeft(r),a=r.rbRight),a.rbLeft&&a.rbLeft.rbRed||a.rbRight&&a.rbRight.rbRed){a.rbRight&&a.rbRight.rbRed||(a.rbLeft.rbRed=!1,a.rbRed=!0,this.rbRotateRight(a),a=r.rbRight),a.rbRed=r.rbRed,r.rbRed=a.rbRight.rbRed=!1,this.rbRotateLeft(r),e=this.root;break}}else if((a=r.rbLeft).rbRed&&(a.rbRed=!1,r.rbRed=!0,this.rbRotateRight(r),a=r.rbLeft),a.rbLeft&&a.rbLeft.rbRed||a.rbRight&&a.rbRight.rbRed){a.rbLeft&&a.rbLeft.rbRed||(a.rbRight.rbRed=!1,a.rbRed=!0,this.rbRotateLeft(a),a=r.rbLeft),a.rbRed=r.rbRed,r.rbRed=a.rbLeft.rbRed=!1,this.rbRotateRight(r),e=this.root;break}a.rbRed=!0,e=r,r=r.rbParent}while(!e.rbRed);e&&(e.rbRed=!1)}},Voronoi.prototype.RBTree.prototype.rbRotateLeft=function(e){var t=e,i=e.rbRight,r=t.rbParent;r?r.rbLeft===t?r.rbLeft=i:r.rbRight=i:this.root=i,i.rbParent=r,t.rbParent=i,t.rbRight=i.rbLeft,t.rbRight&&(t.rbRight.rbParent=t),i.rbLeft=t},Voronoi.prototype.RBTree.prototype.rbRotateRight=function(e){var t=e,i=e.rbLeft,r=t.rbParent;r?r.rbLeft===t?r.rbLeft=i:r.rbRight=i:this.root=i,i.rbParent=r,t.rbParent=i,t.rbLeft=i.rbRight,t.rbLeft&&(t.rbLeft.rbParent=t),i.rbRight=t},Voronoi.prototype.RBTree.prototype.getFirst=function(e){for(;e.rbLeft;)e=e.rbLeft;return e},Voronoi.prototype.RBTree.prototype.getLast=function(e){for(;e.rbRight;)e=e.rbRight;return e},Voronoi.prototype.Diagram=function(e){this.site=e},Voronoi.prototype.Cell=function(e){this.site=e,this.halfedges=[],this.closeMe=!1},Voronoi.prototype.Cell.prototype.init=function(e){return this.site=e,this.halfedges=[],this.closeMe=!1,this},Voronoi.prototype.createCell=function(e){var t=this.cellJunkyard.pop();return t?t.init(e):new this.Cell(e)},Voronoi.prototype.Cell.prototype.prepareHalfedges=function(){for(var e,t=this.halfedges,i=t.length;i--;)(e=t[i].edge).vb&&e.va||t.splice(i,1);return t.sort(function(e,t){return t.angle-e.angle}),t.length},Voronoi.prototype.Cell.prototype.getNeighborIds=function(){for(var e,t=[],i=this.halfedges.length;i--;)null!==(e=this.halfedges[i].edge).lSite&&e.lSite.voronoiId!=this.site.voronoiId?t.push(e.lSite.voronoiId):null!==e.rSite&&e.rSite.voronoiId!=this.site.voronoiId&&t.push(e.rSite.voronoiId);return t},Voronoi.prototype.Cell.prototype.getBbox=function(){for(var e,t,i,r=this.halfedges,s=r.length,o=1/0,a=1/0,n=-1/0,l=-1/0;s--;)(t=(e=r[s].getStartpoint()).x)<o&&(o=t),(i=e.y)<a&&(a=i),t>n&&(n=t),i>l&&(l=i);return{x:o,y:a,width:n-o,height:l-a}},Voronoi.prototype.Cell.prototype.pointIntersection=function(e,t){for(var i,r,s,o,a=this.halfedges,n=a.length;n--;){if(r=(i=a[n]).getStartpoint(),s=i.getEndpoint(),!(o=(t-r.y)*(s.x-r.x)-(e-r.x)*(s.y-r.y)))return 0;if(o>0)return-1}return 1},Voronoi.prototype.Vertex=function(e,t){this.x=e,this.y=t},Voronoi.prototype.Edge=function(e,t){this.lSite=e,this.rSite=t,this.va=this.vb=null},Voronoi.prototype.Halfedge=function(e,t,i){if(this.site=t,this.edge=e,i)this.angle=Math.atan2(i.y-t.y,i.x-t.x);else{var r=e.va,s=e.vb;this.angle=e.lSite===t?Math.atan2(s.x-r.x,r.y-s.y):Math.atan2(r.x-s.x,s.y-r.y)}},Voronoi.prototype.createHalfedge=function(e,t,i){return new this.Halfedge(e,t,i)},Voronoi.prototype.Halfedge.prototype.getStartpoint=function(){return this.edge.lSite===this.site?this.edge.va:this.edge.vb},Voronoi.prototype.Halfedge.prototype.getEndpoint=function(){return this.edge.lSite===this.site?this.edge.vb:this.edge.va},Voronoi.prototype.createVertex=function(e,t){var i=this.vertexJunkyard.pop();return i?(i.x=e,i.y=t):i=new this.Vertex(e,t),this.vertices.push(i),i},Voronoi.prototype.createEdge=function(e,t,i,r){var s=this.edgeJunkyard.pop();return s?(s.lSite=e,s.rSite=t,s.va=s.vb=null):s=new this.Edge(e,t),this.edges.push(s),i&&this.setEdgeStartpoint(s,e,t,i),r&&this.setEdgeEndpoint(s,e,t,r),this.cells[e.voronoiId].halfedges.push(this.createHalfedge(s,e,t)),this.cells[t.voronoiId].halfedges.push(this.createHalfedge(s,t,e)),s},Voronoi.prototype.createBorderEdge=function(e,t,i){var r=this.edgeJunkyard.pop();return r?(r.lSite=e,r.rSite=null):r=new this.Edge(e,null),r.va=t,r.vb=i,this.edges.push(r),r},Voronoi.prototype.setEdgeStartpoint=function(e,t,i,r){e.va||e.vb?e.lSite===i?e.vb=r:e.va=r:(e.va=r,e.lSite=t,e.rSite=i)},Voronoi.prototype.setEdgeEndpoint=function(e,t,i,r){this.setEdgeStartpoint(e,i,t,r)},Voronoi.prototype.Beachsection=function(){},Voronoi.prototype.createBeachsection=function(e){var t=this.beachsectionJunkyard.pop();return t||(t=new this.Beachsection),t.site=e,t},Voronoi.prototype.leftBreakPoint=function(e,t){var i=e.site,r=i.x,s=i.y,o=s-t;if(!o)return r;var a=e.rbPrevious;if(!a)return-1/0;var n=(i=a.site).x,l=i.y,c=l-t;if(!c)return n;var h=n-r,v=1/o-1/c,f=h/c;return v?(-f+this.sqrt(f*f-2*v*(h*h/(-2*c)-l+c/2+s-o/2)))/v+r:(r+n)/2},Voronoi.prototype.rightBreakPoint=function(e,t){var i=e.rbNext;if(i)return this.leftBreakPoint(i,t);var r=e.site;return r.y===t?r.x:1/0},Voronoi.prototype.detachBeachsection=function(e){this.detachCircleEvent(e),this.beachline.rbRemoveNode(e),this.beachsectionJunkyard.push(e)},Voronoi.prototype.removeBeachsection=function(e){var t=e.circleEvent,i=t.x,r=t.ycenter,s=this.createVertex(i,r),o=e.rbPrevious,a=e.rbNext,n=[e],l=Math.abs;this.detachBeachsection(e);for(var c=o;c.circleEvent&&l(i-c.circleEvent.x)<1e-9&&l(r-c.circleEvent.ycenter)<1e-9;)o=c.rbPrevious,n.unshift(c),this.detachBeachsection(c),c=o;n.unshift(c),this.detachCircleEvent(c);for(var h=a;h.circleEvent&&l(i-h.circleEvent.x)<1e-9&&l(r-h.circleEvent.ycenter)<1e-9;)a=h.rbNext,n.push(h),this.detachBeachsection(h),h=a;n.push(h),this.detachCircleEvent(h);var v,f=n.length;for(v=1;v<f;v++)h=n[v],c=n[v-1],this.setEdgeStartpoint(h.edge,c.site,h.site,s);c=n[0],(h=n[f-1]).edge=this.createEdge(c.site,h.site,void 0,s),this.attachCircleEvent(c),this.attachCircleEvent(h)},Voronoi.prototype.addBeachsection=function(e){for(var t,i,r,s,o=e.x,a=e.y,n=this.beachline.root;n;)if((r=this.leftBreakPoint(n,a)-o)>1e-9)n=n.rbLeft;else{if(!((s=o-this.rightBreakPoint(n,a))>1e-9)){r>-1e-9?(t=n.rbPrevious,i=n):s>-1e-9?(t=n,i=n.rbNext):t=i=n;break}if(!n.rbRight){t=n;break}n=n.rbRight}var l=this.createBeachsection(e);if(this.beachline.rbInsertSuccessor(t,l),t||i){if(t===i)return this.detachCircleEvent(t),i=this.createBeachsection(t.site),this.beachline.rbInsertSuccessor(l,i),l.edge=i.edge=this.createEdge(t.site,l.site),this.attachCircleEvent(t),void this.attachCircleEvent(i);if(!t||i){if(t!==i){this.detachCircleEvent(t),this.detachCircleEvent(i);var c=t.site,h=c.x,v=c.y,f=e.x-h,d=e.y-v,p=i.site,u=p.x-h,g=p.y-v,b=2*(f*g-d*u),y=f*f+d*d,x=u*u+g*g,S=this.createVertex((g*y-d*x)/b+h,(f*x-u*y)/b+v);return this.setEdgeStartpoint(i.edge,c,p,S),l.edge=this.createEdge(c,e,void 0,S),i.edge=this.createEdge(e,p,void 0,S),this.attachCircleEvent(t),void this.attachCircleEvent(i)}}else l.edge=this.createEdge(t.site,l.site)}},Voronoi.prototype.CircleEvent=function(){this.arc=null,this.rbLeft=null,this.rbNext=null,this.rbParent=null,this.rbPrevious=null,this.rbRed=!1,this.rbRight=null,this.site=null,this.x=this.y=this.ycenter=0},Voronoi.prototype.attachCircleEvent=function(e){var t=e.rbPrevious,i=e.rbNext;if(t&&i){var r=t.site,s=e.site,o=i.site;if(r!==o){var a=s.x,n=s.y,l=r.x-a,c=r.y-n,h=o.x-a,v=o.y-n,f=2*(l*v-c*h);if(!(f>=-2e-12)){var d=l*l+c*c,p=h*h+v*v,u=(v*d-c*p)/f,g=(l*p-h*d)/f,b=g+n,y=this.circleEventJunkyard.pop();y||(y=new this.CircleEvent),y.arc=e,y.site=s,y.x=u+a,y.y=b+this.sqrt(u*u+g*g),y.ycenter=b,e.circleEvent=y;for(var x=null,S=this.circleEvents.root;S;)if(y.y<S.y||y.y===S.y&&y.x<=S.x){if(!S.rbLeft){x=S.rbPrevious;break}S=S.rbLeft}else{if(!S.rbRight){x=S;break}S=S.rbRight}this.circleEvents.rbInsertSuccessor(x,y),x||(this.firstCircleEvent=y)}}}},Voronoi.prototype.detachCircleEvent=function(e){var t=e.circleEvent;t&&(t.rbPrevious||(this.firstCircleEvent=t.rbNext),this.circleEvents.rbRemoveNode(t),this.circleEventJunkyard.push(t),e.circleEvent=null)},Voronoi.prototype.connectEdge=function(e,t){var i=e.vb;if(i)return!0;var r,s,o=e.va,a=t.xl,n=t.xr,l=t.yt,c=t.yb,h=e.lSite,v=e.rSite,f=h.x,d=h.y,p=v.x,u=v.y,g=(f+p)/2,b=(d+u)/2;if(this.cells[h.voronoiId].closeMe=!0,this.cells[v.voronoiId].closeMe=!0,u!==d&&(s=b-(r=(f-p)/(u-d))*g),void 0===r){if(g<a||g>=n)return!1;if(f>p){if(!o||o.y<l)o=this.createVertex(g,l);else if(o.y>=c)return!1;i=this.createVertex(g,c)}else{if(!o||o.y>c)o=this.createVertex(g,c);else if(o.y<l)return!1;i=this.createVertex(g,l)}}else if(r<-1||r>1)if(f>p){if(!o||o.y<l)o=this.createVertex((l-s)/r,l);else if(o.y>=c)return!1;i=this.createVertex((c-s)/r,c)}else{if(!o||o.y>c)o=this.createVertex((c-s)/r,c);else if(o.y<l)return!1;i=this.createVertex((l-s)/r,l)}else if(d<u){if(!o||o.x<a)o=this.createVertex(a,r*a+s);else if(o.x>=n)return!1;i=this.createVertex(n,r*n+s)}else{if(!o||o.x>n)o=this.createVertex(n,r*n+s);else if(o.x<a)return!1;i=this.createVertex(a,r*a+s)}return e.va=o,e.vb=i,!0},Voronoi.prototype.clipEdge=function(e,t){var i=e.va.x,r=e.va.y,s=0,o=1,a=e.vb.x-i,n=e.vb.y-r,l=i-t.xl;if(0===a&&l<0)return!1;var c=-l/a;if(a<0){if(c<s)return!1;c<o&&(o=c)}else if(a>0){if(c>o)return!1;c>s&&(s=c)}if(l=t.xr-i,0===a&&l<0)return!1;if(c=l/a,a<0){if(c>o)return!1;c>s&&(s=c)}else if(a>0){if(c<s)return!1;c<o&&(o=c)}if(l=r-t.yt,0===n&&l<0)return!1;if(c=-l/n,n<0){if(c<s)return!1;c<o&&(o=c)}else if(n>0){if(c>o)return!1;c>s&&(s=c)}if(l=t.yb-r,0===n&&l<0)return!1;if(c=l/n,n<0){if(c>o)return!1;c>s&&(s=c)}else if(n>0){if(c<s)return!1;c<o&&(o=c)}return s>0&&(e.va=this.createVertex(i+s*a,r+s*n)),o<1&&(e.vb=this.createVertex(i+o*a,r+o*n)),(s>0||o<1)&&(this.cells[e.lSite.voronoiId].closeMe=!0,this.cells[e.rSite.voronoiId].closeMe=!0),!0},Voronoi.prototype.clipEdges=function(e){for(var t,i=this.edges,r=i.length,s=Math.abs;r--;)t=i[r],(!this.connectEdge(t,e)||!this.clipEdge(t,e)||s(t.va.x-t.vb.x)<1e-9&&s(t.va.y-t.vb.y)<1e-9)&&(t.va=t.vb=null,i.splice(r,1))},Voronoi.prototype.closeCells=function(e){for(var t,i,r,s,o,a,n,l,c,h=e.xl,v=e.xr,f=e.yt,d=e.yb,p=this.cells,u=p.length,g=Math.abs;u--;)if((t=p[u]).prepareHalfedges()&&t.closeMe){for(s=(r=t.halfedges).length,i=0;i<s;){if(a=r[i].getEndpoint(),l=r[(i+1)%s].getStartpoint(),g(a.x-l.x)>=1e-9||g(a.y-l.y)>=1e-9)switch(!0){case this.equalWithEpsilon(a.x,h)&&this.lessThanWithEpsilon(a.y,d):if(c=this.equalWithEpsilon(l.x,h),n=this.createVertex(h,c?l.y:d),o=this.createBorderEdge(t.site,a,n),i++,r.splice(i,0,this.createHalfedge(o,t.site,null)),s++,c)break;a=n;case this.equalWithEpsilon(a.y,d)&&this.lessThanWithEpsilon(a.x,v):if(c=this.equalWithEpsilon(l.y,d),n=this.createVertex(c?l.x:v,d),o=this.createBorderEdge(t.site,a,n),i++,r.splice(i,0,this.createHalfedge(o,t.site,null)),s++,c)break;a=n;case this.equalWithEpsilon(a.x,v)&&this.greaterThanWithEpsilon(a.y,f):if(c=this.equalWithEpsilon(l.x,v),n=this.createVertex(v,c?l.y:f),o=this.createBorderEdge(t.site,a,n),i++,r.splice(i,0,this.createHalfedge(o,t.site,null)),s++,c)break;a=n;case this.equalWithEpsilon(a.y,f)&&this.greaterThanWithEpsilon(a.x,h):if(c=this.equalWithEpsilon(l.y,f),n=this.createVertex(c?l.x:h,f),o=this.createBorderEdge(t.site,a,n),i++,r.splice(i,0,this.createHalfedge(o,t.site,null)),s++,c)break;if(a=n,c=this.equalWithEpsilon(l.x,h),n=this.createVertex(h,c?l.y:d),o=this.createBorderEdge(t.site,a,n),i++,r.splice(i,0,this.createHalfedge(o,t.site,null)),s++,c)break;if(a=n,c=this.equalWithEpsilon(l.y,d),n=this.createVertex(c?l.x:v,d),o=this.createBorderEdge(t.site,a,n),i++,r.splice(i,0,this.createHalfedge(o,t.site,null)),s++,c)break;if(a=n,c=this.equalWithEpsilon(l.x,v),n=this.createVertex(v,c?l.y:f),o=this.createBorderEdge(t.site,a,n),i++,r.splice(i,0,this.createHalfedge(o,t.site,null)),s++,c)break;default:throw"Voronoi.closeCells() > this makes no sense!"}i++}t.closeMe=!1}},Voronoi.prototype.dumpBeachline=function(e){if(console.log("Voronoi.dumpBeachline(%f) > Beachsections, from left to right:",e),this.beachline)for(var t=this.beachline.getFirst(this.beachline.root);t;)console.log("  site %d: xl: %f, xr: %f",t.site.voronoiId,this.leftBreakPoint(t,e),this.rightBreakPoint(t,e)),t=t.rbNext;else console.log("  None")},Voronoi.prototype.quantizeSites=function(e){for(var t,i=this.ε,r=e.length;r--;)(t=e[r]).x=Math.floor(t.x/i)*i,t.y=Math.floor(t.y/i)*i},Voronoi.prototype.recycle=function(e){if(e){if(!(e instanceof this.Diagram))throw"Voronoi.recycleDiagram() > Need a Diagram object.";this.toRecycle=e}},Voronoi.prototype.compute=function(e,t){var i=new Date;this.reset(),this.toRecycle&&(this.vertexJunkyard=this.vertexJunkyard.concat(this.toRecycle.vertices),this.edgeJunkyard=this.edgeJunkyard.concat(this.toRecycle.edges),this.cellJunkyard=this.cellJunkyard.concat(this.toRecycle.cells),this.toRecycle=null);var r=e.slice(0);r.sort(function(e,t){var i=t.y-e.y;return i||t.x-e.x});for(var s,o,a,n=r.pop(),l=0,c=this.cells;;)if(a=this.firstCircleEvent,n&&(!a||n.y<a.y||n.y===a.y&&n.x<a.x))n.x===s&&n.y===o||(c[l]=this.createCell(n),n.voronoiId=l++,this.addBeachsection(n),o=n.y,s=n.x),n=r.pop();else{if(!a)break;this.removeBeachsection(a.arc)}this.clipEdges(t),this.closeCells(t);var h=new Date,v=new this.Diagram;return v.cells=this.cells,v.edges=this.edges,v.vertices=this.vertices,v.execTime=h.getTime()-i.getTime(),this.reset(),v},"undefined"!=typeof module&&(module.exports=Voronoi);let seed=parseInt(tokenData.hash.slice(0,16),16);class Random{constructor(e){this.seed=e}random_dec(){return this.seed^=this.seed<<13,this.seed^=this.seed>>17,this.seed^=this.seed<<5,(this.seed<0?1+~this.seed:this.seed)%1e3/1e3}random_between(e,t){return e+(t-e)*this.random_dec()}random_int(e,t){return Math.floor(this.random_between(e,t+1))}random_choice(e){return e[Math.floor(this.random_between(0,.99*e.length))]}}let hash=tokenData.hash,R=new Random(seed);var WIDTH=window.innerWidth,HEIGHT=window.innerHeight,canvasSize=Math.min(WIDTH,HEIGHT),canvOffset=canvasSize/10,fieldSize=canvasSize+2*canvOffset,cor=canvasSize/(canvasSize+canvasSize/2),framecor=canvasSize/100,numcells=R.random_between(15,100),vertexMinimumDist=canvasSize/15,offset=1.7*canvasSize/(85/numcells*80),voronoi=new Voronoi,bbox={xl:0,xr:canvasSize,yt:0,yb:canvasSize+canvasSize/2},sites=[];sites=setRandoms(canvasSize,canvasSize+canvasSize/2,vertexMinimumDist,numcells);var cursite,curvert,vert,check,bottom,vcols,vrows,c1,c2,coloption=R.random_between(0,50)-30,diagram=voronoi.compute(sites,bbox),vedges=diagram.edges,vcells=diagram.cells,cellscale=.8,coloffset=.9,skylinesize=canvasSize/200,npoints=40,srotation=R.random_between(0,80)-20,pninc=.05,vinc=3e-4,vscale=30,zoff=0,speedcoef=[],fishgroups=R.random_between(1,4);(fishcount=(R.random_between(5,250)+R.random_between(5,250)+R.random_between(5,250))/3)<10&&(fishgroups=1);for(var fishtype=[],delay=[],sinlen=[],sinadd=[],magnit=[],groupCoef=[],groupColor=[],groupHueOffset=[],pnvalue=[],v=[],c=[],shadow=[],cf=(groupHueOffset=[],fishcount),groupAverage=fishcount/fishgroups,fishcount=[],starfish=R.random_between(0,100),sfx=R.random_between(canvasSize/6,canvasSize-canvasSize/6),sfy=R.random_between(canvasSize/6,canvasSize-canvasSize/6),sfsize=canvasSize/(Math.sqrt(4*numcells)/1.5),sfrotate=R.random_between(0,360),snoise=R.random_between(0,9999),particles=[],flowfield=[],frameCount=0,g=0;g<fishgroups;g++){if(g!=fishgroups-1){let e=(Math.floor(groupAverage),cf-(fishgroups-1-g)*(1+Math.floor(groupAverage))/2);cf-=e,fishcount.push(e)}else fishcount.push(cf);sinlen.push(R.random_between(500,1e3)),fishtype.push(R.random_between(0,100)),sinadd.push(R.random_between(1.5,2)),magnit.push(R.random_between(1,1.8)*(canvasSize/1000)),groupCoef.push(R.random_between(.9,1.3)+g/fishgroups/2),groupColor.push(R.random_between(0,1)),ran=R.random_between(0,100),ran<60?groupHueOffset.push(0):ran>80?groupHueOffset.push(180):groupHueOffset.push(230),delay.push(1e3*g),particles.push([]),speedcoef.push(0),shadow.push(canvasSize/60*groupCoef[g])}function setup(){createCanvas(canvasSize,canvasSize),pixelDensity(2),colorMode(HSB),c1=color(186+coloption,90,59),c2=color(224+coloption,100,19),colorMode(RGB),img1=createImage(width,height),img1.loadPixels();for(let e=0;e<width;e++)for(let t=0;t<height;t++)col=t<canvasSize*coloffset?color(c1.levels[0]+(c2.levels[0]-c1.levels[0])*t/canvasSize/coloffset,c1.levels[1]+(c2.levels[1]-c1.levels[1])*t/canvasSize/coloffset,c1.levels[2]+(c2.levels[2]-c1.levels[2])*t/canvasSize/coloffset):color(c2),img1.set(e,t,col);img1.updatePixels(),image(img1,0,0),fill(c2),offset=canvasSize/80,noStroke(),beginShape(),vertex(0,0),vertex(canvasSize,0),vertex(canvasSize,canvasSize),vertex(0,canvasSize);for(var e=0;e<vedges.length;e++)noStroke(),line(vedges[e].va.x,vedges[e].va.y,vedges[e].vb.x,vedges[e].vb.y);for(e=0;e<vcells.length;e++)castVertexes(e),beginContour(),castVoronoi(e),endContour(CLOSE);endShape(CLOSE),bottom=get(),frameRate(30),vcols=vscale,vrows=vscale;for(var t=0;t<fishgroups;t++){flowfield[t]=new Array(vcols*vrows),colorMode(HSB);var i=color((206+coloption+groupHueOffset[t])%360,27,82),r=color((200+coloption+groupHueOffset[t])%360,70,65);colorMode(RGB),c.push(color(((r.levels[0]-i.levels[0])*groupColor[t]+i.levels[0]-c2.levels[0])*(groupCoef[t]-.3)+c2.levels[0],((r.levels[1]-i.levels[1])*groupColor[t]+i.levels[1]-c2.levels[1])*(groupCoef[t]-.3)+c2.levels[1],((r.levels[2]-i.levels[2])*groupColor[t]+i.levels[2]-c2.levels[2])*(groupCoef[t]-.3)+c2.levels[2]));for(e=0;e<fishcount[t];e++)particles[t][e]=new Particle,pnvalue.push(0),v.push(0)}frame()}function draw(){frameCount+=20,blendMode(BLEND),image(bottom,0,0),starfish<3&&genstarfish(c1),push(),noiseDetail(4,.2);for(var e=0;e<fishgroups;e++)speedcoef[e]=3*(noise(frameCount/500+delay[e])+.2)*(Math.sin((frameCount+delay[e])/sinlen[e])+sinadd[e]);pop(),noiseSeed(0);for(var t=0,i=0;i<vrows;i++){for(var r=0,s=0;s<vcols;s++){var o=s+i*vcols;for(e=0;e<fishgroups;e++)pnvalue[e]=noise(r+delay[e],t+delay[e],zoff+delay[e])*TWO_PI*4,v[e]=p5.Vector.fromAngle(pnvalue[e]),v[e].setMag(magnit[e]),flowfield[e][o]=v[e];r+=pninc}t+=pninc,zoff+=vinc}angleMode(DEGREES);for(e=0;e<fishgroups;e++)for(var a=0;a<particles[e].length;a++)strokeWeight(canvasSize/200*groupCoef[e]),particles[e][a].follow(flowfield[e],a),particles[e][a].update(speedcoef[e]),particles[e][a].castShadow(groupCoef[e],shadow[e],c2,fishtype[e]),particles[e][a].edges();for(e=0;e<fishgroups;e++)for(a=0;a<particles[e].length;a++)strokeWeight(canvasSize/200*groupCoef[e]),particles[e][a].show(groupCoef[e],c[e],fishtype[e]);push(),translate(canvasSize/2,canvasSize/2),rotate(-srotation),noiseSeed(snoise),colorMode(HSB);var n=color((186+coloption)%360,35,85,.65);colorMode(RGB);var l=canvasSize/(2*skylinesize);smooth(),strokeWeight(.03);for(let e=0;e<l;e++){n.setAlpha(alpha(n)-l/7e3),fill(n),stroke(n),beginShape(),curveVertex(-canvOffset-e*skylinesize-canvasSize/2,e*skylinesize-canvOffset+2.5*canvOffset-canvasSize/2);for(let t=0;t<npoints;t++)curveVertex(-canvOffset-e*skylinesize+(fieldSize-canvOffset-e*skylinesize-(-canvOffset-e*skylinesize))*t/npoints-noise(t/2,millis()/1500)*(canvasSize/8)+canvasSize*(t/npoints)/1.2-canvasSize/2,e*skylinesize-canvOffset+(canvasSize+canvOffset+e*skylinesize-(e*skylinesize-canvOffset))*t/npoints+noise(t/3,millis()/1500)*(canvasSize/19)+2.5*canvOffset-canvasSize/2);curveVertex(fieldSize-canvOffset-e*skylinesize+canvasSize/1.2-canvasSize/2,canvasSize+canvOffset+e*skylinesize+2.5*canvOffset-canvasSize/2),curveVertex(fieldSize-canvOffset-(e+1)*skylinesize+canvasSize/1.2-canvasSize/2,canvasSize+canvOffset+(e+1)*skylinesize+2.5*canvOffset-canvasSize/2);for(let t=npoints-1;t>=0;t--)curveVertex(-canvOffset-(e+1)*skylinesize+(fieldSize-canvOffset-(e+1)*skylinesize-(-canvOffset-(e+1)*skylinesize))*t/npoints-noise(t/2,millis()/1500)*(canvasSize/8)+canvasSize*(t/npoints)/1.2-canvasSize/2,(e+1)*skylinesize-canvOffset+(canvasSize+canvOffset+(e+1)*skylinesize-((e+1)*skylinesize-canvOffset))*t/npoints+noise(t/3,millis()/1500)*(canvasSize/19)+2.5*canvOffset-canvasSize/2);if(curveVertex(-canvOffset-(e+1)*skylinesize-canvasSize/2,(e+1)*skylinesize-canvOffset+2.5*canvOffset-canvasSize/2),endShape(CLOSE),alpha(n)<l/7e3)break}pop(),frame()}groupCoef.sort(),shadow.sort();