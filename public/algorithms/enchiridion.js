let q1,q2,q3,q5,q10,q20,q100,q200,its=0,s,c,ctx;const fs={};let gs;const hp=[];for(let s=0;s<32;s++)hp.push(tokenData.hash.slice(2+2*s,4+2*s));const dp=hp.map(s=>parseInt(s,16));let seed=parseInt(tokenData.hash.slice(0,16),16);function setup(){noiseSeed(seed),s=new S;var t=min(windowWidth,windowHeight);c=createCanvas(t,t),ctx=c.drawingContext,q1=width/1080,q2=width/540,q3=width/360,q5=width/216,q10=width/108,q20=width/54,q100=width/10.8,q200=width/5.4,strokeWeight(q3),gs=new GS,background(gs.bkgrndClr);var r=(width-q200)/gs.nCls*.1,h=(height-q200)/gs.nRws*.1;let i,o,l,d;if(gs.s===s.s.P)prttn(q100,q100,width-q200,height-q200);else if(gs.s===s.s.G){l=((width-q200)/gs.nCls-r/gs.nCls)*(1-map(gs.nCls,2,4,0,.2)/gs.nCls),d=((height-q200)/gs.nRws-h/gs.nRws)*(1-map(gs.nRws,2,4,0,.2)/gs.nRws);let t=0;for(let s=0;s<gs.nRws;s++){o=q100+(h+d)*s;for(let s=0;s<gs.nCls;s++)i=q100+(r+l)*s,crtF(t++,l,d,i,o)}}else if(gs.s===s.s.H){l=width-q200,d=((height-q200)/gs.nRws-h/gs.nRws)*(1-map(gs.nRws,2,4,0,.2)/gs.nRws),i=q100;for(let s=0;s<gs.nRws;s++)o=q100+(h+d)*s,crtF(s,l,d,i,o)}else if(gs.s===s.s.V){l=((width-q200)/gs.nCls-r/gs.nCls)*(1-map(gs.nCls,2,4,0,.2)/gs.nCls),d=height-q200,o=q100;for(let s=0;s<gs.nCls;s++)i=q100+(r+l)*s,crtF(s,l,d,i,o)}else i=q100,o=q100,l=width-q200,d=height-q200,crtF(0,l,d,i,o)}function prttn(h,i,c,o){var s=rnd(),t=s<gs.pwc,r=s<gs.pwc+gs.phc&&s>gs.pwc,l=s<gs.pwc+gs.phc+gs.prc&&s>gs.pwc+gs.phc,s=rnd(.1,.7);if(t&&c>q200)return prttn(h,i,c*s,o),void prttn(h+c*s,i,c*(1-s),o);if(r&&o>q200)return prttn(h,i,c,o*s),void prttn(h,i+o*s,c,o*(1-s));if(l&&c>q200&&o>q200){var d,e=floor(rnd(1,min(c/q200,6)))||1,n=floor(rnd(1,min(o/q200,6)))||1,p=crtF(Object.keys(fs).length,c/e-q10,o/n-q10,h+q5,i+q5);for(let r=0;r<e;r++)for(let t=0;t<n;t++)for(let s=0;s<p.length;s++)0===r&&0===t||(d=p[s],new Rct(h+d.x+c/e*r+q5,i+d.y+o/n*t+q5,d.w,d.h,d.clr,d.sClr,d.dec,d.fId).shw())}else crtF(Object.keys(fs).length,c-q10,o-q10,h+q5,i+q5)}function crtF(s,t,r,h,i){const c=new Flt(s,t,r,h,i);return fs[s]=c,c.dStl(),c.sClrs(),push(),translate(c.x,c.y),c.drw(),pop(),c.rcts}class Flt{constructor(s,t,r,h,i){this.id=s,this.fW=t,this.fH=r,this.x=h,this.y=i,this.cp,this.sClr,this.lcp,this.rDec,this.rcts=[],this.pwc,this.phc,this.prc}dStl(){this.cp=gs.cp,this.lcp=this.gLClrs(this.cp),this.pwc=rnd(.01,.3),this.phc=rnd(.01,.3),this.prc=rnd(.01,.2);var t=dptp(dp[1]);this.rDec=t<.09?s.rd.PRP:t<.18?s.rd.PAR:t<.27?s.rd.CH:t<.315?s.rd.MLN:t<.36?s.rd.MLR:t<.43?s.rd.G:t<.52?s.rd.SR:t<.61?s.rd.SG:t<.69?s.rd.RR:t<.77?s.rd.RN:s.rd.N}drw(){this.rcts=this.drwRct(0,0,this.fW,this.fH,rndFArr(this.cp),0),this.rcts.forEach(s=>{push(),s.shw(),pop()})}drwRct(s,t,h,i,r,c){var o=rnd(),l=o<this.pwc,d=o<this.pwc+this.phc&&o>this.pwc,e=o<this.pwc+this.phc+this.prc&&o>this.pwc+this.phc,n=rnd(.3,.7);if(l&&h>q20){o=this.drwRct(s,t,h*n,i,this.gRClr(r),c+1),l=this.drwRct(s+h*n,t,h*(1-n),i,this.gRClr(r),c+1);return[...o,...l]}if(d&&i>q20){d=this.drwRct(s,t,h,i*n,this.gRClr(r),c+1),n=this.drwRct(s,t+i*n,h,i*(1-n),this.gRClr(r),c+1);return[...d,...n]}if(e&&s>q10&&t>q10){var p,w=floor(rnd(1,min(h/q10,6)))||1,q=floor(rnd(1,min(i/q10,6)))||1,g=this.drwRct(s,t,h/w,i/q,this.gRClr(r),c+1);const f=[];for(let r=0;r<w;r++)for(let t=0;t<q;t++)for(let s=0;s<g.length;s++)0===r&&0===t||(p=g[s],f.push(new Rct(p.x+h/w*r,p.y+i/q*t,p.w,p.h,p.clr,p.sClr,p.dec,p.fId)));return[...g,...f]}e=new Rct(s+n2v(s,t,-q5,q5),t+n2v(s,t,-q5,q5),h,i,r,this.sClr,this.rDec,this.id,c);let a=[];return h>q100&&i>q100/2&&(a=this.drwRct(s+q5,t+q5,h-q10,i-q10,this.gRClr(r),++c)),its=max(its,c),[e,...a]}gRClr(s){return rnd()<gs.cCoh?rndFArr(this.cp):s}sClrs(){this.sClr=color(0)}gLClrs(){const t=[];return this.cp.forEach(s=>{t.push(this.gLClr(s))}),t}gLClr(s){var t=s.levels[0]+20,r=s.levels[1]+20,s=s.levels[2]+20;return color(t,r,s)}}class Rct{constructor(s,t,r,h,i,c,o,l){this.x=s,this.y=t,this.w=r,this.h=h,this.clr=i,this.sClr=c,this.oClr=i,this.oSClr=c,this.dec=o,this.dir=this.w>this.h?0:1,this.spks=[],this.fId=l,this.decHlpr()}decHlpr(){var t,r=[s.rd.PRP,s.rd.PAR,s.rd.CH];this.dec===s.rd.MLR?this.dec=rndFArr(r):this.dec===s.rd.MLN&&(t=floor(map(noise(this.x/q100,this.y/q100),0,1,0,r.length)),this.dec=r[t]),this.dec===s.rd.RR?this.dec=rndFArr(s.rdfran):this.dec===s.rd.RN&&(this.dec=s.rdfran[floor(map(noise(this.x/q100,this.y/q100),0,1,0,s.rdfran.length))]),this.dec===s.rd.PAR&&(this.dir=1-this.dir),this.dec===s.rd.SR&&(this.spks=this.gRSpks(floor(map(round(max(this.w,this.h)/width,12),0,1,1,64))))}shw(){stroke(this.sClr),fill(this.clr),rect(this.x,this.y,this.w,this.h),push(),this.drwDec(),pop()}drwDec(){var t,r,h;[s.rd.PRP,s.rd.PAR,s.rd.CH].includes(this.dec)?(strokeWeight(q1),stroke(this.gSClr()),h=floor(map((this.dec===s.rd.PAR?min:max)(this.w,this.h),0,width,1,100)),this.dec===s.rd.CH&&(this.dir=null,t=floor(map(this.w,0,width,1,50)),r=floor(map(this.h,0,height,1,50)),this.drwHLns(t),this.drwVLns(r)),0===this.dir?this.drwHLns(h):1===this.dir&&this.drwVLns(h)):this.dec===s.rd.SR?(strokeWeight(q1),stroke(this.gSClr(!0)),fill(this.gSClr(!0)),this.dSR()):this.dec===s.rd.SG?(r=floor(map(this.w,0,width,1,50)),h=floor(map(this.h,0,height,1,50)),strokeWeight(q1),stroke(this.gSClr(!0)),fill(this.gSClr(!0)),this.dSG(r,h)):this.dec===s.rd.G&&this.dGrad()}drwHLns(t){for(let s=1;s<=t;s++){var r=this.x+map(s,0,t+1,q1/2,this.w-q1/2),h=this.y+q3/2+q1/2,i=this.y+this.h-q3/2-q1/2;line(r,h,r,i)}}drwVLns(t){for(let s=1;s<=t;s++){var r=this.y+map(s,0,t+1,q1/2,this.h-q1/2),h=this.x+q3/2+q1/2,i=this.x+this.w-q3/2-q1/2;line(h,r,i,r)}}gRSpks(t){const r=[];for(let s=0;s<t;s++){var h=rnd(this.x+q3/2,this.x+this.w-q3/2),i=rnd(this.y+q3/2,this.y+this.h-q3/2);r.push(new Spk(h,i))}return r}dSR(){for(let s=0;s<this.spks.length;s++)this.spks[s].s()}dSG(t,r){for(let s=1;s<=t;s++){var h=this.x+map(s,0,t+1,0,this.w);for(let s=1;s<=r;s++){var i=this.y+map(s,0,r+1,0,this.h);circle(h,i,q1)}}}dGrad(){let s=ctx.createLinearGradient(this.x,this.y,this.x+this.w,this.y+this.h);var t=this.clr,r=this.gSClr();s.addColorStop(0,t),s.addColorStop(1,r),ctx.fillStyle=s,rect(this.x,this.y,this.w,this.h)}gSClr(s=!1){var t=s?fs[this.fId].lcp:fs[this.fId].cp,s=fs[this.fId].cp.indexOf(this.clr);return 0===s?t[t.length-1]:t[s-1]}}class Spk{constructor(s,t){this.x=s,this.y=t}s(){circle(this.x,this.y,q1/2)}}function n2v(s,t,r,h){s=map(s,0,width,0,25),t=map(t,0,height,0,25);return map(noise(s,t),0,1,r,h)}function rnd(s=0,t=1){return seed^=seed<<13,seed^=seed>>17,seed^=seed<<5,map((seed<0?1+~seed:seed)%1e3/1e3,0,1,s,t)}function rndFArr(s){return s[floor(rnd(0,s.length))]}function dptp(s){return map(s,0,255,0,1)}class GS{constructor(){this.cpNm=Object.keys(s.cp)[floor(map(dptp(dp[7]),0,1,0,Object.keys(s.cp).length-1e-9))],this.cp=s.cp[this.cpNm],this.hasbkgrnd=dptp(dp[0])<.399,this.hasbkgrnd?this.bkgrndClr=rndFArr(this.cp):this.bkgrndClr=255;let t=dptp(dp[2]);t<.06?this.cCoh=s.cCoh.M:t<.16?this.cCoh=s.cCoh.H:t<.36?this.cCoh=s.cCoh.R:this.cCoh=s.cCoh.N,t=dptp(dp[3]),t<.2?(this.prttn=!0,t=dptp(dp[6]),t<.5?(this.pwc=rnd(.3,.4),this.phc=rnd(.3,.4),this.prc=rnd(.1,.2)):(this.pwc=rnd(.3,.7),this.phc=rnd(.3,.7),this.prc=0),this.nCls=0,this.nRws=0):(this.prttn=!1,t=dptp(dp[4]),t<.73?this.nCls=1:t<.82?this.nCls=2:t<.91?this.nCls=3:this.nCls=4,t=dptp(dp[5]),t<.73?this.nRws=1:t<.82?this.nRws=2:t<.91?this.nRws=3:this.nRws=4),1<this.nCls?1<this.nRws?this.s=s.s.G:this.s=s.s.V:1<this.nRws?this.s=s.s.H:this.prttn?this.s=s.s.P:this.s=s.s.N}}class S{constructor(){this.cp={A:[color("#a2b58b"),color("#a064fa"),color("#e3e2bc"),color("#c896c8"),color("#64f0fa")],B:[color("#141414"),color("#f3f3f3")],C:[color("#0D3D63"),color("#1D9275"),color("#25B7C3"),color("#EFE5AD"),color("#E35123")],D:[color("#563621"),color("#CF4B3B"),color("#ECC0AE"),color("#A5988F"),color("#D59273")],E:[color("#11304F"),color("#365558"),color("#6DBDD7"),color("#D8E2DE"),color("#FEFEFD")],F:[color("#E4572E"),color("#17BEBB"),color("#2E282A"),color("#fad350"),color("#76B041")],G:[color("#8a2f2f"),color("#d3ebd3"),color("#0a0a59"),color("#e0ca79")],H:[color("#FF9FB2"),color("#FBDCE2"),color("#0ACDFF"),color("#60AB9A"),color("#A17AB8")],I:[color("#F5FBEF"),color("#92AD94"),color("#748B75"),color("#C6EF80"),color("#503D42")],J:[color("#F0A202"),color("#581F18"),color("#F18805"),color("#D95D39"),color("#202C59")],K:[color("#46E0E0"),color("#959ba1"),color("#758396"),color("#47C4AD"),color("#9DA3A1")]},this.rd={N:"n",PRP:"prp",PAR:"par",MLR:"mlr",MLN:"mln",CH:"ch",SR:"sr",SG:"sg",RR:"rr",RN:"rn",G:"g"},this.cCoh={M:0,R:1,H:.1,N:.38},this.rdfran=[this.rd.N,this.rd.PRP,this.rd.PAR,this.rd.CH,this.rd.SR,this.rd.SG],this.s={N:"n",H:"h",V:"v",G:"g",P:"p"}}}
