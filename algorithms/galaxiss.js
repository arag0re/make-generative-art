(()=>{"use strict";const e=THREE,t=4095;let l=4,n=.5;const i=e=>.5*(1-Math.cos(e*Math.PI));let r;const s=function(e,s=0,o=0){if(null==r){r=new Array(4096);for(let e=0;e<4096;e++)r[e]=Math.random()}e<0&&(e=-e),s<0&&(s=-s),o<0&&(o=-o);let a,c,u,h,p,d=Math.floor(e),_=Math.floor(s),w=Math.floor(o),f=e-d,E=s-_,S=o-w,N=0,T=.5;for(let e=0;e<l;e++){let e=d+(_<<4)+(w<<8);a=i(f),c=i(E),u=r[e&t],u+=a*(r[e+1&t]-u),h=r[e+16&t],h+=a*(r[e+16+1&t]-h),u+=c*(h-u),e+=256,h=r[e&t],h+=a*(r[e+1&t]-h),p=r[e+16&t],p+=a*(r[e+16+1&t]-p),h+=c*(p-h),u+=i(S)*(h-u),N+=u*T,T*=n,d<<=1,f*=2,_<<=1,E*=2,w<<=1,S*=2,f>=1&&(d++,f--),E>=1&&(_++,E--),S>=1&&(w++,S--)}return N},o=function(e,t){e>0&&(l=e),t>0&&(n=t)},a=function(e){const t=(()=>{const e=4294967296;let t,l;return{t(n){l=t=(null==n?Math.random()*e:n)>>>0},l:()=>t,i:()=>(l=(1664525*l+1013904223)%e,l/e)}})();t.t(e),r=new Array(4096);for(let e=0;e<4096;e++)r[e]=t.i()};var c=window,u=document,h=u.createElement("meta");function p(e,t,l){let n=e/(t[1]-t[0]);return l[0]+n*(l[1]-l[0])}function d(){return x.o>.8}function _(){return x.u>.85}function w(){return x.h>.9}function f(e){for(let t of e.children)t.receiveShadow=!0}function E(e,t,l,n,i,r){(y=new e(16777215,t)).castShadow=!0,y.position.set(n,i,r),y.target.position.set(0,0,0),y.shadow.mapSize.width=4096,y.shadow.mapSize.height=4096,y.shadow.camera.near=1,y.shadow.camera.p=200,y.shadow.bias=-5e-4,(M=new e(16777215,l)).castShadow=!1,M.position.set(n,i,r),M.target.position.set(0,0,0),B?(y.angle=Math.PI/6.5,y.penumbra=1,y.decay=2.5,M.angle=Math.PI/6.5,M.penumbra=1,M.distance=130,M.decay=2.5,C._=0):(y.shadow.camera.right=100,y.shadow.camera.left=-100,y.shadow.camera.top=100,y.shadow.camera.bottom=-100,C._=.1),H.add(M),H.add(y)}function S(){B?E(e.SpotLight,.5,2==b?2.3:2.8,0,0,100):E(e.DirectionalLight,.4,2==b?.5:.6,-60,60,60),H.add(C)}function N(){let t=B?1:0,l=(new e.Color).copy(k[b][0]);P.setClearColor(l.multiplyScalar(G[b][t]))}function T(e){let t=e*v;return t^=t<<13,t^=t>>17,t^=t<<5,(t<0?1+~t:t)%1e3/1e3}h.name="viewport",h.content="width=device-width, initial-scale=1.0",u.getElementsByTagName("head")[0].appendChild(h);var y,M,L=(t,l,n)=>new e.Vector3(t,l,n),m=(t,l)=>new e.Vector2(t,l),A=(t,l,n)=>new e.BoxGeometry(t,l,n),D=(t,l)=>new e.Mesh(t,l),g=(t,l,n)=>((t,l,n)=>new e.Color(t,l,n))(t/255,l/255,n/255),z=e.MeshPhongMaterial,F=Event,I=CustomEvent,x={S:0,N:0,T:0,M:0,L:0,m:0,A:0,D:0,F:0,I:0,O:0,v:0,R:0,u:0,o:0,H:0,h:0},O={S:[0,1,0,1],N:[2,3,0,1],T:[4,5,0,1],M:[8,9,16,20],L:[10,11,.32,.44],m:[12,13,.07,.1],A:[14,14,0,.4],D:[15,16,.22,.25],F:[17,18,1.5,2.8],I:[25,26,0,1],O:[1,1,1.05,1.1],v:[2,2,4,10],R:[0,0,0,1],u:[19,20,0,1],o:[6,7,0,1],H:[27,27,0,6],h:[30,31,0,1]},b=0,v=1e6,R=75,H=new e.Scene,P=function(){let t=new e.WebGLRenderer({antialias:!0,alpha:!0});return t.setPixelRatio(c.devicePixelRatio),t.setSize(c.innerWidth,c.innerHeight),t.shadowMap.enabled=!0,t.shadowMap.type=e.VSMShadowMap,c.addEventListener("resize",(()=>{t.setSize(c.innerWidth,c.innerHeight)})),u.body.appendChild(t.domElement),t}(),C=new e.AmbientLight(16777215,.1);!function(){let e=[];for(let t=0;t<32;t++)e.push(tokenData.hash.slice(2+2*t,4+2*t));for(let t in O){let l="",n=O[t];for(let t=n[0];t<=n[1];t++)l+=e[t];let i=2**(4*l.length)-1,r=p(parseInt(l,16),[0,i],[n[2],n[3]]);x[t]=r}0!=(b=x.R<.7?0:x.R<.8?1:x.R<.9?2:3)&&(x.L=Math.min(.35,x.L)),x.D+=x.L,x.A+=x.L}();var B=_(),Y=!1,U={P:L(1,0,0),C:L(0,1,0),B:L(0,0,1)},V=g(255,255,255),k=[[g(158,210,255),g(31,113,141),g(150,159,178),g(93,70,50),g(255,220,127),g(255,220,127),g(85,113,28),g(34,72,18),g(236,240,241)],[g(50,48,49),g(31,113,141),g(50,48,49),g(8,76,97),g(0,99,93),g(255,200,87),g(0,99,93),g(175,46,41),g(240,235,216)],[g(85,85,151),g(159,159,237),g(50,48,49),g(242,223,215),g(11,122,117),g(107,75,62),g(11,122,117),g(212,193,236),g(240,243,245)],[g(9,66,70),g(132,172,206),g(125,29,63),g(107,75,62),g(216,228,206),g(216,228,206),g(13,92,99),g(179,145,174),g(238,244,237)]],G=[[.8,.07],[.8,.25],[.7,.15],[.9,.2]];N();var K=.03,W=.02,q=new z({color:0==b?11141120:1==b?k[b][1]:k[b][2]}),Z=new z({color:16777215}),X=new z({color:0}),j=new z({color:16766720});class J{constructor(t,l,n,i,r,s){let o=this;o.group=new e.Group,o.Y(),o.U(),o.V(),o.k(),o.G=o.K(),o.W(),o.q(),f(o.G),f(o.group),o.speed=1.3,o.Z=l,o.X=n,o.j=r,o.J=i,o.$=s,o.ee=.5,o.te=0,o.le=new e.Quaternion,o.group.position.set(t.x,t.y,t.z),o.group.rotation.y=Math.PI,o.setScale(L(K,K,K)),o.ne=new e.Group,o.ne.add(o.group),o.camera=o.ie()}setScale(e){this.group.scale.copy(e)}update(e){let t=this;t.G.rotation.z+=.4*e/10,o(4,.5),a(t.J);let l=.001,n=s(t.J+t.te*l),i=.005*n;a(t.j),l=.01,n=s(t.j+t.te*l);let r=.01*(n-.5);a(t.j),l=.001,n=s(t.$+t.te*l);let c=.02*(n-t.ee);t.te+=1,t.le.setFromAxisAngle(U.C,r*t.speed*e/7),t.ne.quaternion.multiply(t.le),t.le.setFromAxisAngle(U.P,-i*t.speed*e/7),t.ne.quaternion.multiply(t.le),t.le.setFromAxisAngle(U.B,2*-r*t.speed*e/7),t.group.quaternion.multiply(t.le);let u=t.group.position,h=u.length();if(t.ee=(h-t.Z)/(t.X-t.Z),h<t.Z&&c<0||h>t.X&&c>0)return;let p=L().copy(u).multiplyScalar(c);u.add(p),t.camera.position.add(p)}ie(){let t=this,l=new e.PerspectiveCamera(50,c.innerWidth/c.innerHeight,.01,300),n=L();t.group.getWorldPosition(n);let i=L();t.group.getWorldDirection(i);let r=l.position;r.set(n.x,n.y,n.z),r.multiplyScalar(1.03),r.add(i.normalize().multiplyScalar(.032)),l.quaternion.multiply(t.ne.quaternion);let s=new e.Quaternion;return s.setFromAxisAngle(U.P,-Math.PI/4),l.quaternion.multiply(s),t.ne.add(l),l}Y(){let e=A(40,40,100);e.vertices[1].y-=8,e.vertices[1].x-=15,e.vertices[3].y+=20,e.vertices[3].x-=15,e.vertices[4].y-=8,e.vertices[4].x+=15,e.vertices[6].y+=20,e.vertices[6].x+=15;let t=D(e,q);this.group.add(t)}U(){let e=A(40,40,20);e.vertices[0].y-=7,e.vertices[0].x-=7,e.vertices[2].y+=7,e.vertices[2].x-=7,e.vertices[5].y-=7,e.vertices[5].x+=7,e.vertices[7].y+=7,e.vertices[7].x+=7;let t=D(e,Z);t.position.z=60,this.group.add(t)}V(){let e=A(11,30,15);e.vertices[0].x-=4,e.vertices[1].x-=4,e.vertices[4].x+=4,e.vertices[5].x+=4;let t=D(e,Z),l=t.position;l.z-=52,l.y+=15.7,t.rotation.x+=.2,this.group.add(t);let n=A(50,3,13),i=D(n,Z),r=i.position;r.z-=52,r.y+=12,this.group.add(i)}k(){let e=A(170,4,30),t=[{re:-5,se:5},{re:25,se:5}];for(let l of t){let t=D(e,q),n=t.position;n.y+=l.re,n.z+=l.se,this.group.add(t)}let l=A(2,30,3),n=[{px:70,re:10,se:10,oe:.2},{px:70,re:10,se:0,oe:.2},{px:-70,re:10,se:10,oe:-.2},{px:-70,re:10,se:0,oe:-.2},{px:-12,re:11,se:0,oe:.5},{px:-12,re:11,se:10,oe:.5},{px:12,re:11,se:0,oe:-.5},{px:12,re:11,se:10,oe:-.5}];for(let e of n){let t=D(l,Z),n=t.position;n.x+=e.px,n.y+=e.re,n.z+=e.se,t.rotation.z+=e.oe,this.group.add(t)}}K(){let e=A(10,10,20),t=D(e,Z);return t.position.z=65,this.group.add(t),t}W(){let e=A(6,70,1),t=D(e,X);t.position.z=8,this.G.add(t)}q(){var t,l;let n=A(2,30,3),i=[{px:-9,re:-20,se:30,rx:.5},{px:-9,re:-20,se:10,rx:-.5},{px:9,re:-20,se:30,rx:.5},{px:9,re:-20,se:10,rx:-.5},{px:0,re:-33,se:20,rx:0,oe:Math.PI/2,ae:.9}];for(let e of i){let i=D(n,X),r=i.position;r.x+=e.px,r.y+=e.re,r.z+=e.se,i.rotation.x+=e.rx,i.rotation.z=null!==(t=e.oe)&&void 0!==t?t:0,i.scale.y=null!==(l=e.ae)&&void 0!==l?l:1,this.group.add(i)}let r=new e.CylinderGeometry(7,7,3,20),s=[{px:11},{px:-11}];for(let e of s){let t=D(r,Z),l=t.position;l.x+=e.px,l.y+=-33,l.z+=20,t.rotation.z=Math.PI/2,this.group.add(t)}}}class Q{constructor(t,l,n,i,r,s){let o=this;o.group=new e.Group,o.Y(),o.U(),o.V(),o.ce=o.ue(),o.he=o.pe(),o.q(),o.W(),f(o.ce),f(o.he),f(o.group),o.speed=1,o.de=.4,o.Z=l,o.X=n,o.j=r,o.J=i,o.$=s,o.ee=.5,o.te=0,o.le=new e.Quaternion,o._e=new e.Raycaster,o._e.p=n+1,o.we=!1,o.fe=!1,o.Ee=!1,o.Se=Q.Ne,o.Te=null,o.group.position.set(t.x,t.y,t.z),o.group.rotation.y=Math.PI,o.setScale(L(K,K,K)),o.ne=new e.Group,o.ne.add(o.group),o.camera=o.ie(),o.ye=0,o.Me=0}setScale(e){this.group.scale.copy(e)}update(e,t){let l=this,n=L();l.group.getWorldDirection(n);let i=L();l.group.getWorldPosition(i),l.ce.rotation.y+=l.de*t/10,l.he.rotation.x+=l.de*t/10,l.we?l.Le(t):l.Ee?(l.Se-=t,l.Se<=0&&l.me()):l.fe?l.Ae(t):(l.De(t),l.Se-=t,l.Se<=0&&l.ge(e))}ge(e){let t=this,l=L();t.group.getWorldPosition(l);let n=L().copy(l).multiplyScalar(-1).normalize();t._e.set(l,n);let i=t._e.intersectObject(e.ze);if(i.length>0){let e=i[0];if(e.point.length()<=1.02*te.Fe)t.Se=Q.Ne;else{let{a:l,b:n,c:i}=e.face,r=e.object.geometry.getAttribute("biom").array,s=[r[l],r[n],r[i]];if(s.includes(3)||s.includes(4)||s.includes(5)||s.includes(6))t.Se=Q.Ne;else{t.we=!0,t.de=.2,t.Te=e;let l=L();t.group.getWorldPosition(l),t.Me=l.length()}}}else t.Se=Q.Ne}Le(t){let l=this,n=L().copy(l.Te.point).length(),i=L();if(l.group.getWorldPosition(i),i.length()-n<=.5)l.we=!1,l.Ee=!0,l.de=.1,l.Se=Q.Ie;else{let n=5e-4*t/7,i=l.group.position,r=L().copy(i).multiplyScalar(n);i.sub(r);let s=new e.Quaternion,o=-2e-4*t/7;l.ye>-Math.PI/2&&(l.ye+=o,s.setFromAxisAngle(U.P,o),l.camera.quaternion.multiply(s))}}me(){let e=this;Math.random()>.5?(e.Ee=!1,e.fe=!0,e.de=.4):e.Se=Q.Ie}Ae(t){let l=this,n=L();if(l.group.getWorldPosition(n),l.Me-n.length()<=0)l.fe=!1,l.Se=Q.Ne;else{let n=l.group.position,i=5e-4*t/7,r=L().copy(n).multiplyScalar(i);n.add(r);let s=new e.Quaternion,o=2e-4*t/7;l.ye<0&&(l.ye+=o,s.setFromAxisAngle(U.P,o),l.camera.quaternion.multiply(s))}}De(e){let t=this;o(1,.6),a(t.J);let l=.001,n=s(t.J+t.te*l),i=.005*n;a(t.j),l=.01,n=s(t.j+t.te*l);let r=.01*(n-.3);a(t.j),l=.001,n=s(t.$+t.te*l);let c=.02*(n-t.ee);t.te+=1,t.le.setFromAxisAngle(U.C,r*e/7),t.ne.quaternion.multiply(t.le),t.le.setFromAxisAngle(U.P,-i*t.speed*e/7),t.ne.quaternion.multiply(t.le);let u=t.group.position,h=u.length();if(t.ee=(h-t.Z)/(t.X-t.Z),h<t.Z&&c<0||h>t.X&&c>0)return;let p=L().copy(u).multiplyScalar(c);u.add(p),t.camera.position.add(p)}ie(){let t=this,l=new e.PerspectiveCamera(50,c.innerWidth/c.innerHeight,.01,300),n=L();t.group.getWorldPosition(n);let i=L();t.group.getWorldDirection(i);let r=l.position;r.set(n.x,n.y,n.z),r.multiplyScalar(1.2),r.add(i.normalize().multiplyScalar(-2.8)),l.quaternion.multiply(t.ne.quaternion);let s=new e.Quaternion;return s.setFromAxisAngle(U.P,-Math.PI/3),l.quaternion.multiply(s),t.ne.add(l),l}Y(){let e=this,t=A(50,20,100);t.vertices[0].z-=15,t.vertices[5].z-=15;let l=D(t,j);e.group.add(l);let n=A(50,15,100);n.vertices[3].z+=15,n.vertices[6].z+=15;let i=D(n,X);i.position.y-=17.5,e.group.add(i);let r=A(50,15,10);r.vertices[0].y-=3,r.vertices[2].y+=3,r.vertices[5].y-=3,r.vertices[7].y+=3;let s=D(r,X),o=s.position;o.y-=17.5,o.z+=55,e.group.add(s);let a=A(50,10,85);a.vertices[3].z+=15,a.vertices[6].z+=15,a.vertices[2].z-=15,a.vertices[7].z-=15;let c=D(a,j),u=c.position;u.y-=30,u.z+=7.5,e.group.add(c)}U(){let e=A(20,10,40);e.vertices[0].z-=7,e.vertices[5].z-=7,e.vertices[2].x+=3,e.vertices[3].z-=99,e.vertices[3].x-=4,e.vertices[6].z-=99,e.vertices[6].x+=4;let t=D(e,X),l=t.position;l.y+=15,l.z+=10,this.group.add(t)}V(){let e=this,t=A(50,20,60);t.vertices[1].x-=18,t.vertices[3].x-=18,t.vertices[3].y+=13,t.vertices[4].x+=18,t.vertices[6].x+=18,t.vertices[6].y+=13;let l=D(t,j);l.position.z-=80,e.group.add(l);let n=A(70,3,15),i=D(n,X),r=i.position;r.y+=5,r.z-=80,e.group.add(i);let s=A(2,20,15),o=[{px:-35},{px:35}];for(let t of o){let l=D(s,X),n=l.position;n.x+=t.px,n.y+=5,n.z+=-80,e.group.add(l)}}ue(){let e=A(4,30,4),t=D(e,X),l=t.position;return l.y+=15,l.z+=10,this.group.add(t),t}pe(){let e=A(10,4,4),t=D(e,X),l=t.position;return l.x+=10,l.y+=6,l.z-=105,this.group.add(t),t}W(){let e=this,t=A(160,2,12),l=D(t,X);l.position.y+=12,e.ce.add(l);let n=D(t,X);n.position.y+=12,n.rotation.y+=Math.PI/2,e.ce.add(n);let i=A(2,20,3),r=D(i,X);r.position.x+=3,e.he.add(r)}q(){let e=A(2,3,60),t=[{px:30},{px:-30}];for(let l of t){let t=D(e,X),n=t.position;n.x+=l.px,n.y-=50,n.z+=10,this.group.add(t)}let l=A(2,20,3),n=[{px:25,se:25,oe:Math.PI/7},{px:25,se:-5,oe:Math.PI/7},{px:-25,se:25,oe:-Math.PI/7},{px:-25,se:-5,oe:-Math.PI/7}];for(let e of n){let t=D(l,X),n=t.position;n.x+=e.px,n.y+=-40,n.z+=e.se,t.rotation.z+=e.oe,this.group.add(t)}}}Q.Ne=2e4,Q.Ie=1e4;class ${constructor(t,l,n,i){let r=this;r.xe=new e.Group,r.Oe=new e.Group;let s=V;for(let o=0;o<n;o++){let n=T(i+(o+1)),a=T(n),c=T(a),u=T(c),h=T(u),p=n*l+t,d=new e.DodecahedronBufferGeometry(p),_=L(12*(a-.5),12*(c-.5),4*(u-1)),w=1-_.length()/6,f=new e.MeshBasicMaterial({color:s,opacity:Math.max(w,.1),transparent:!0}),E=D(d,f);r.Oe.add(E),E.position.set(_.x,_.y,_.z);let S=.7+1*h;E.scale.set(S,S,S),E.receiveShadow=!0}r.xe.add(r.Oe);let o=T(i),a=T(o),c=T(a),u=T(c);r.be={axis:L(o,a,c).normalize(),speed:1e-5+3e-5*u,quaternion:new e.Quaternion,ne:r.xe}}update(e){let{axis:t,speed:l,quaternion:n,ne:i}=this.be;n.setFromAxisAngle(t,e*l),i.quaternion.multiply(n)}}class ee{constructor(t){let l=this;l.ve=new e.Group,l.ve.position.set(0,0,0),l.ve.receiveShadow=!0,l.Re=l.He(t-2,15),l.Pe=null,l.Pe=l.Ce(t+2,0),l.Be=null,w()&&(l.Be=l.Ce(t+2,1))}Ye(){H.add(this.ve)}rotate(e){this.ve.applyQuaternion(e)}update(e,t){let l=this;for(let e of l.Re)e.update(t);null!=l.Pe&&l.Pe.update(t),null!=l.Be&&l.Be.update(e,t)}He(e,t){let l=[];for(let n=0;n<Math.ceil(x.H);n++){let i=T(x.I+(n+1)),r=T(i),s=T(r),o=T(s),a=new $(.5,1.5,40,i),c=2*Math.PI*r,u=2*Math.PI*s,h=e+o*t,p=a.Oe.position;p.x=h*Math.sin(c)*Math.cos(u),p.z=h*Math.cos(c)*Math.cos(u),p.y=h*Math.sin(u),a.Oe.lookAt(0,0,0),this.ve.add(a.xe),l.push(a)}return l}Ce(e,t){let l=T(x.I*x.I+t),n=T(l),i=T(n),r=L(0,e,0),s=l,o=n,a=i,c=0==t?new J(r,e,e+20,o,s,a):new Q(r,e,e+20,o,s,a);return this.ve.add(c.ne),c}}class te{constructor(){let e=this;e.X=0;let t=[{id:0,Ue:!0,Ve:!0,ke:{Ge:x.M,Ke:.05,We:.5,qe:3,minValue:x.L,Ze:L(0,0,0)},Xe:[{color:k[b][5],je:1.03},{color:k[b][6],je:10}]},{id:1,Ue:!1,Ve:!1,Je:[0],ke:{Ge:2,Ke:x.m,We:.5,qe:2,minValue:x.A,Ze:L(0,0,0)},Xe:[{color:k[b][4],je:10}]},{id:2,Ue:!1,Ve:!1,Je:[0],ke:{Ge:1,Ke:1,We:.35,qe:2,minValue:.2+x.L,Ze:L(10,10,10)},Xe:[{color:k[b][6],je:10}]},{id:3,Ue:!1,Ve:!0,ke:{Ge:7.2,Ke:.037,We:.49,qe:x.v,minValue:x.D,Ze:L(0,0,0)},Xe:[{color:k[b][3],je:x.O},{color:k[b][2],je:10},{color:k[b][8],je:200}]},{id:4,Ue:!1,Ve:!0,Je:[3],ke:{Ge:.8,Ke:1,We:.5,qe:x.v,minValue:x.D,Ze:L(15,15,15)},Xe:[{color:k[b][3],je:x.O},{color:k[b][2],je:10},{color:k[b][8],je:200}]},{id:5,Ue:!1,Ve:!1,Je:[0,3,4],Qe:1.1*te.Fe,ke:{Ge:4,Ke:.06,We:.46,qe:Math.round(x.F),minValue:.41,Ze:L(0,0,0)},Xe:[{color:k[b][6],je:10}]},{id:6,Ue:!1,Ve:!0,Je:[5],ke:{Ge:1,Ke:5,We:.51,qe:4,minValue:.3,Ze:L(0,0,0)},Xe:[{color:k[b][7],je:10}]},{id:7,Ue:!1,Ve:!0,Je:[2],ke:{Ge:.7,Ke:3,We:.5,qe:2,minValue:.4,Ze:L(0,0,0)},Xe:[{color:k[b][6],je:10}]}];e.$e=e.et(t,R),e.$e.castShadow=!0,w()?(e.ze=e.et(t,30),e.ze.visible=!1):e.ze=null}et(t,l){let n=new e.IcosahedronBufferGeometry(te.Fe,l),i=new e.MeshToonMaterial({flatShading:!0,vertexColors:!0}),r=n.getAttribute("position").array.length/3,s=new Int32Array(r).fill(-1);n.setAttribute("biom",new e.BufferAttribute(s,1));let o=new Float32Array(3*r).fill(0);n.setAttribute("color",new e.BufferAttribute(o,3)),this.tt(n,te.Fe,t),this.lt(n,te.Fe,t);let a=D(n,i);return a.receiveShadow=!0,a}tt(t,l,n){let i=this,r=t.getAttribute("position"),s=new Float32Array(r.array.length);s.set(r.array);let o=r.array.length/3,c=t.getAttribute("biom"),u=new Int32Array(c.array.length);u.set(c.array);let h=0,p=[],_=T(x.T)*v;a(_);for(let e=0;e<o;e++){let t=r.array[3*e],o=r.array[3*e+1],a=r.array[3*e+2],c=L(t,o,a);for(let t of n)if(t.Ue)u[e]=t.id,h=i.nt(c,t.ke,d()?0:_),p[e]=h,c.normalize().multiplyScalar(l+h),s[3*e]=c.x,s[3*e+1]=c.y,s[3*e+2]=c.z;else{if(null!=t.Qe&&c.length()>t.Qe)continue;let n=u[e];if(null!=t.Je&&!t.Je.includes(n))continue;let r=p[e],o=h+i.nt(c,t.ke,d()?0:_)*r;o>h&&(u[e]=t.id,t.Ve&&(h=o,c.normalize().multiplyScalar(l+h),s[3*e]=c.x,s[3*e+1]=c.y,s[3*e+2]=c.z))}let w=c.length();w>i.X&&(i.X=w)}t.setAttribute("position",new e.BufferAttribute(s,3)),t.setAttribute("biom",new e.BufferAttribute(u,1))}lt(t,l,n){let i=new Float32Array(t.getAttribute("color").array.length),r=t.getAttribute("position"),s=t.getAttribute("biom"),o=r.array.length/3;for(let e=0;e<o;e++){let t=n.find((t=>t.id==s.array[e]));if(null==t){i[3*e]=k[b][3].r,i[3*e+1]=k[b][3].g,i[3*e+2]=k[b][3].b;continue}let o,a=r.array[3*e],c=r.array[3*e+1],u=r.array[3*e+2],h=L(a,c,u).length();if((3==t.id||4==t.id)&&h>1.2*te.Fe&&h>=.88*this.X)o=t.Xe[t.Xe.length-1].color;else for(let e of t.Xe)if(h<l*e.je){o=e.color;break}i[3*e]=o.r,i[3*e+1]=o.g,i[3*e+2]=o.b}t.setAttribute("color",new e.BufferAttribute(i,3)),w()||t.deleteAttribute("biom")}nt(e,t,l){o(t.qe,t.We);let n=l+e.x*t.Ke+t.Ze.x,i=l+e.y*t.Ke+t.Ze.y,r=l+e.z*t.Ke+t.Ze.z,a=s(n,i,r);return Math.max(0,a-t.minValue)*t.Ge}Ye(){let e=this;H.add(e.$e),null!=e.ze&&H.add(e.ze)}rotate(e){var t;this.$e.applyQuaternion(e),null===(t=this.ze)||void 0===t||t.applyQuaternion(e)}}te.Fe=39.5;class le{constructor(){let t=this,l=new e.IcosahedronGeometry(le.it,35),n=l.vertices.length;t.rt=[];for(let e=0;e<n;e++){let n=T(x.N+e+1),i=T(n),r=T(i),s=T(r),o=l.vertices[e],a=i,c=.3*r,u=.03*s;t.rt.push({y:o.y,x:o.x,z:o.z,st:a,ot:c,speed:u})}let i=new e.MeshToonMaterial({flatShading:!0,color:k[b][1]});t.at=D(l,i),t.at.receiveShadow=!0,t.at.castShadow=!0}Ye(){H.add(this.at)}update(e){let t=this.at.geometry,l=t.vertices,n=l.length;for(let t=0;t<n;t++){let n=T(x.N+t+1),i=T(n),r=T(i),s=l[t],o=this.rt[t];s.x=o.x+Math.cos(o.st+.001*n*e)*o.ot,s.y=o.y+Math.sin(o.st+.001*i*e)*o.ot,s.z=o.z+Math.sin(o.st+.001*r*e)*o.ot,o.st+=o.speed}t.verticesNeedUpdate=!0}rotate(e){this.at.applyQuaternion(e)}}le.it=40;class ne{constructor(){let t=this;t.le=new e.Quaternion;let l=T(x.S),n=T(l);t.ut=m(.002*l,.002*n),t.ht=new te,t.dt=new le,t._t=new ee(t.ht.X)}Ye(){let e=this;e._t.Ye(),e.ht.Ye(),e.dt.Ye()}update(e,t){let l=this;if(e||Y){let e=l.ut.clone().multiplyScalar(-.02*t/6);l.ut.add(e)}l.wt(t),Y||(l.dt.update(t),l._t.update(l.ht,t))}ft(e,t){this.ut.set(e,t).divideScalar(Y?3e3:1300)}wt(e){let t=this,l=[[U.P,t.ut.x],[U.C,t.ut.y]];for(let n of l)t.le.setFromAxisAngle(n[0],n[1]*e/6),t._t.rotate(t.le),t.ht.rotate(t.le),t.dt.rotate(t.le)}}class ie{constructor(){let t=this;t.Et=new e.PerspectiveCamera(75,c.innerWidth/c.innerHeight,.1,400);let l=t.Et.position;l.y=0,l.x=0,l.z=180,t.Et.lookAt(0,0,0),t.St=t.Et,t.Nt=!1,t.Tt=!1,t.yt=new Map,t.Mt(),t.Lt=new re,t.At=new ne,t.Dt=!1,t.delta=0}static gt(){return null==ie.zt?(ie.zt=new ie,ie.zt):ie.zt}static Ft(){null!=ie.zt&&(ie.zt.It(),ie.zt=void 0)}Ye(){this.At.Ye()}update(e){let t=this;t.delta=e,t.At.update(t.Dt,e)}render(){P.render(H,this.St)}Mt(){let e=this;e.xt("resize",(()=>{e.Et.aspect=c.innerWidth/c.innerHeight,e.Et.updateProjectionMatrix();let t=e.At._t.Pe;null!=t&&(t.camera.aspect=c.innerWidth/c.innerHeight,t.camera.updateProjectionMatrix());let l=e.At._t.Be;null!=l&&(l.camera.aspect=c.innerWidth/c.innerHeight,l.camera.updateProjectionMatrix())})),e.xt("keydown",(t=>{if("p"==t.key)c.dispatchEvent(new F("p"));else if("h"==t.key)c.dispatchEvent(new F("h"));else if("n"==t.key&&_())B=!B,N(),H.remove(C),H.remove(y),H.remove(M),S();else if(" "==t.key)Y=!Y;else if(!isNaN(t.key)&&" "!=t.key){!function(e){Y=!1,R=e,H.clear(),S(),ie.Ft(),ie.gt().Ye()}("0"===t.key?300:30*t.key)}e.St.updateProjectionMatrix()})),e.xt("wheel",(e=>{c.dispatchEvent(new I("zw",{detail:e.deltaY>0?70:-70}))})),e.xt("contextmenu",(e=>e.preventDefault())),e.xt("pointercancel",(t=>{e.Lt.Ot(t)})),e.xt("pointerleave",(t=>{e.Lt.Ot(t)})),e.xt("pointerout",(t=>{e.Lt.Ot(t)})),e.xt("pointerup",(t=>{e.Lt.Ot(t)})),e.xt("pointerdown",(t=>{e.Lt.Ot(t)})),e.xt("pointermove",(t=>{e.Lt.Ot(t)})),e.xt("a",(t=>{e.Nt?w()?c.dispatchEvent(new F("h")):c.dispatchEvent(new F("p")):e.Tt?c.dispatchEvent(new F("h")):c.dispatchEvent(new F("p"))})),e.xt("s",(t=>{e.Dt=t.detail})),e.xt("r",(t=>{let l=e.delta/8;e.At.ft(t.detail.dy*l,t.detail.dx*l)})),e.xt("zw",(e=>{let t=e.detail;c.dispatchEvent(new I("z",{detail:t}))})),e.xt("z",(t=>{let l=t.detail;l>0?e.St.fov<115&&(e.St.fov+=l/50):e.St.fov>20&&(e.St.fov+=l/50),e.St.updateProjectionMatrix()})),e.xt("p",(t=>{let l=e.At._t.Pe;if(null!=l)if(e.Nt){e.St=e.Et,e.Nt=!1,l.setScale(L(K,K,K));let t=e.At._t.Be;null!=t&&t.setScale(L(K,K,K))}else{l.setScale(L(.01,.01,.01)),e.St=l.camera,e.Nt=!0;let t=e.At._t.Be;null!=t&&(t.setScale(L(W,W,W)),e.Tt=!1)}})),e.xt("h",(t=>{let l=e.At._t.Be;if(null!=l)if(e.Tt){e.St=e.Et,e.Tt=!1,l.setScale(L(K,K,K));let t=e.At._t.Pe;null!=t&&t.setScale(L(K,K,K))}else{l.setScale(L(.01,.01,.01)),e.St=l.camera,e.Tt=!0;let t=e.At._t.Pe;null!=t&&(t.setScale(L(W,W,W)),e.Nt=!1)}}))}xt(e,t){this.yt.set(e,t),c.addEventListener(e,t)}It(){for(let[e,t]of this.yt)c.removeEventListener(e,t)}}class re{constructor(){let e=this;e.bt=[],e.vt=[],e.Rt=new Map}Ot(e){let t=this;switch(e.preventDefault(),e.type){case"pointerdown":0==t.bt.length?(t.bt.push(e),t.Rt.set(e.pointerId,[e]),c.dispatchEvent(new I("s",{detail:!0}))):1==t.bt.length?(t.bt.push(e),t.Rt.set(e.pointerId,[e]),c.dispatchEvent(new I("s",{detail:!1}))):2==t.bt.length?(t.bt.push(e),c.dispatchEvent(new I("s",{detail:!1}))):(t.bt=[],t.vt=[],t.Rt.clear());break;case"pointerout":case"pointercancel":case"pointerleave":case"pointerup":if(1==t.bt.length){t.bt.pop();t.Rt.clear(),c.dispatchEvent(new I("s",{detail:!1}))}else 2==t.bt.length?0==t.vt.length?t.vt.push(e):1==t.vt.length&&(t.bt=[],t.vt=[],t.Rt.clear()):3==t.bt.length&&(t.vt.length<2?t.vt.push(e):2==t.vt.length&&(t.bt=[],t.vt=[],t.Rt.clear(),c.dispatchEvent(new I("a"))));break;case"pointermove":if(1==t.bt.length){let l=t.Rt.get(e.pointerId);if(null!=l&&2==l.length){let n=l[0],i=e.clientX-n.clientX,r=e.clientY-n.clientY;c.dispatchEvent(new I("r",{detail:{dx:i,dy:r}})),t.Rt.clear()}else null==l?t.Rt.set(e.pointerId,[e]):l.push(e)}else if(2==t.bt.length){let l=t.Rt.get(t.bt[0].pointerId),n=t.Rt.get(t.bt[1].pointerId);if(l.length+n.length>=2){let i=l[l.length-1],r=n[n.length-1],s=m(i.clientX-r.clientX,i.clientY-r.clientY).length(),o=e.pointerId==t.bt[0].pointerId?r:i,a=m(e.clientX-o.clientX,e.clientY-o.clientY).length()-s;c.dispatchEvent(new I("zw",{detail:8*-a}))}let i=t.Rt.get(e.pointerId);null==i?t.Rt.set(e.pointerId,[e]):i.push(e)}}}Ht(){let e=this;e.bt=[],e.vt=[],e.Rt.clear()}}!function(){S(),ie.gt().Ye();let e=0,t=u.getElementsByTagName("canvas")[0];t.style.touchAction="none",t.style.userSelect="none",t.style.cursor="pointer",t.style.overflow="hidden",t.style.width="100%",t.style.height="100%",requestAnimationFrame((function t(l){let n=l-e;e=l,ie.gt().update(n),ie.gt().render(),requestAnimationFrame(t)}))}()})();