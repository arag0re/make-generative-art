function setup(){W=window.innerWidth,H=window.innerHeight,DIM=min(W,H),createCanvas(DIM,DIM),M=DIM/1e3,hw=500,CH=.5*DIM,angleMode(DEGREES),strokeJoin(ROUND),imageMode(CENTER),noiseSeed(S[0]),noiseDetail(1),cn=[["#312E28","#4B7278","#B45062","#CBC29B","#438839","#AA292D","#BA8B2C","#D97E90"],["#4F0004","#7A0100","#AD262A","#C3C6A9","#8F7787","#523851","#260910"],["#115565","#9C61E1","#E9C79E","#B65538","#973E47","#C487ED","#27474E"],["#2A4363","#D4E28D","#9BB88C","#89AE9D","#6D8C87","#727B98","#735F7B","#6DC3AA","#3D7A95","#D05F61"],["#002C54","#FFBD6A","#FE86A0","#83639A","#689A3D","#317849","#FE4465","#135569","#EDE2C5"],["#7267C6","#8A86A7","#78B7DE","#B1D9F9","#FEA466","#FCD57D","#F96E66","#CC4D6A"],["#712357","#38213B","#309DA9","#0E837B","#509F46","#8ABA40","#FFD23F","#ED6A5A"],["#40204B","#E09F3D","#ECB75A","#F6D8A7","#E36E77","#A2D2BA"],["#3C3C3C","#087E8B","#FF5A5F","#F2D0A4"],["#0A000A","#FFFFF5"]],cg=[gp(["#E3002D","#EB800E"]),gp(["#18002B","#5A1BAC"]),gp(["#980042","#FF3583"]),gp(["#012B10","#199800"]),gp(["#0F0F0F","#F0F0F0"]),gp(["#000328","#00458E"]),gp(["#490000","#B11818"]),gp(["#080808","#12233A"])],cl=[gp(["#63D69A","#EEFF38"]),gp(["#C5EF86","#0BE6B6"]),gp(["#FCFC62","#67E54D"]),gp(["#FDFF75","#00BAED"]),R()<.5?gp(["#BE84DE","#B04A22"]):["#F02733","#396BF5","#FFD605"],gp(["#E3E31F","#FF7300"]),gp(["#F0A202","#E4551C"]),gp(["#CFFF88","#D0FEF5"])],G=20;let t=R()<.5?7:6;T=ch([20]),ci=0==T?ri(0,t):ri(0,cn.length-1),C=0==T?cg[ci]:cn[ci],R()<.1&&0!=ci?(gl=gp(["#F50062","#0098F0","#FFEC3D"]),prt=!0):(gl=cl[ci],prt=!1),U=0==ch([30]),E=0==ch([5]),F=sqrt(R()),L=0==T&&0==ch([70]),ln=C[0],t=ch([10,20,6]),ba=0==t?rb(20,40):1==t?rb(10,20):2==t?0:rb(1,10),bs=ch([10,30]),t=ch([20,20]),ga=0==t?0:1==t?rb(5,10):rb(1,5),gs=ch([20,30,5]),asp=ch([40,20]),st=ch([1,10,60]),t=ch([20,25]),si=0==t?150:1==t?25:75,nu=ch([15,10,20]);let opt=0==nu?[3,4,5]:1==nu?[10,11,12]:2==nu?[ri(3,8)]:[2,2,3,3,3,4,5,6,7,8,9,10];nyc=0==ch([25]),B=1,A=0==ch([1]),D=0==ch([30]),H=7,ovg=0==ch([10]),C=sp(C),bg=C[0],1==T&&ci==cn.length-1&&(bg="#FFFFF5",R()<.75&&(D=!0)),rl=mr(),bgp=[],t=1e3;let o=-2*(hw+t)*tan(-90+G);sca=ovg?.005:.003,oo=1e3,sd(db(-hw,-hw-t),db(hw+o,-hw-t),db(hw,hw+t),db(-hw-o,hw+t),bgp,!1,1,15),B=0,pll=[];let tp=sa(re(bgp,20,100));for(let s of tp){let p=s.p,x=lerp(p[3].x,p[2].x,.5),y=p[3].y,d=p[2].x-p[3].x,f=constrain(map(y,-400,hw,F,0),0,F),n=ri(1,5);pll.push(new P(x,y,.75*d,rc(opt),-90,f,s.c,n))}pg=createGraphics(DIM,DIM),pg.translate(CH,CH),pg.scale(M),pg.background(bg),pg.strokeJoin(ROUND);for(let s of bgp){let amt=constrain(map(s.p[3].y,-400,hw,F,0),0,F);pg.stroke(cm(lc(s.c,bg,amt),1.15)),pg.noFill(),pg.beginShape();for(let p of s.p)pg.vertex(p.x,p.y);pg.endShape(CLOSE)}for(let s of bgp){let amt=constrain(map(s.p[3].y,-400,hw,F,0),0,F);pg.fill(cm(lc(s.c,bg,amt),1.15)),pg.noStroke(),pg.beginShape();for(let p of s.p)pg.vertex(p.x,p.y);pg.endShape()}step=0,stop=pll.length-1}function draw(){translate(CH,CH),step>stop&&(image(pg,0,0),noLoop());for(let i=0;i<25;i++){if(step<=stop){let p=pll[step];U||(C=sp(C)),D||(rl=mr()),p.run()}step++}}class P{constructor(x,y,w,n,h,f,c,ns,d=0){this.q={f:[],r:[],l:[],t:[],e:[],fe:[]},this.f=f,this.c=c,this.m=[],this.d=d,this.ns=ns,this.n=n,this.cut=!1;let p1,p2,p3,p4,t=rc([!0,!1]),s=[],hh=[],bba=ba,inv=!1,gga=rc([-ga,ga]),mod=y<hw?1:constrain(map(y,hw,hw+500,1,.5),.5,1);for(let i=0;i<this.n;i++){let j=.5*w,a=j*cos(-G),b=j*sin(-G);p4=db(x+j*cos(h-90),y+j*sin(h-90)),p3=db(x+j*cos(h+90),y+j*sin(h+90)),p1=db(p4.x+a,p4.y+b),p2=db(p3.x+a,p3.y+b),i==n-1&&(this.fh=h),s.push([p1,p2,p3,p4]),hh.push(h);let ph=h;if(0!=i){let n=2==bs?noise(.001*x,.001*y):sn(x+oo,y+oo,.005);0==bs||2==bs?(bba=map(n,0,1,-ba,ba),inv?bba*=-1:bba=bba):5==ri(0,10)?t?(bba=ba,t=!t):(bba=-ba,t=!t):bba=0,(h+bba>0||h+bba<-180)&&(bba*=-1,inv=!0),h+=bba}let o=ri(0,10);if(3==gs?w+=gga:0==gs?w+=ga:1==gs?w-=ga:5==o?w-=ga:6==o?w+=ga:w=w,(w<6||w>75)&&(1==asp||2==asp&&5!=ri(0,10))){this.fh=ph,this.cut=!0;break}w=constrain(w,5,75),x+=si*cos(h)*mod,y+=si*sin(h)*mod}t=s.length;for(let i=0;i<t-1;i++){let a=s[i],b=s[i+1],k=hh[i+1],pr=hh[i];this.q.f.push([b[3],b[2],a[2],a[3]]),this.q.r.push([b[2],b[1],a[1],a[2]]),this.q.l.push([b[0],b[3],a[3],a[0]]),0==i&&(k<-G?this.q.fe.push(a[3],a[2],a[2],a[1]):this.q.fe.push(a[0],a[3],a[3],a[2])),k<=5-G&&(this.q.e.push(a[1],b[1]),this.q.fe.push(b[3],a[3])),k>-G&&(this.q.e.push(a[0],b[0]),this.q.fe.push(b[2],a[2])),pr>-G&&k<-G&&this.q.e.push(a[2],a[1]),pr<=-G&&k>-G&&this.q.e.push(a[0],a[3])}this.q.t=s[t-1];let q=this.q.t;this.fh<-G-90?this.q.fe.push(q[1],q[2],q[2],q[3]):this.fh>-G?this.q.fe.push(q[0],q[1],q[1],q[2]):this.q.fe.push(q[0],q[1],q[0],q[3]),this.hh=hh}run(){let md=0==st?9:1==st?.75:2==st?.25:-1;this.fh<-G-90?(!this.cut&&this.d<this.ns&&R()<md&&this.stack(),this.pattern()):(this.pattern(),!this.cut&&this.d<this.ns&&R()<md&&this.stack())}stack(){let h=this.fh,q=this.q.t,p0=q[0],p1=q[1],p2=q[2],p3=q[3],t=mp(p0,p2),d=dv(p0,p1);this.d++,this.m.push(new P(t.x,t.y,.5*d,3,h,this.f,this.c,this.ns,this.d));for(let m of this.m)m.run()}pattern(){let a=[],i=0;for(let q of this.q.l)fr(q)&&this.hh[i+1]>=-G&&sd(q[0],q[1],q[2],q[3],a,!0,.8,H,this.c),i++;a=this.show(a);for(let q of this.q.r)fr(q)&&sd(q[0],q[1],q[2],q[3],a,!0,.7,H,this.c);a=this.show(a),this.edge(this.q.e);for(let q of this.q.f)fr(q)&&sd(q[0],q[1],q[2],q[3],a,!0,1,H,this.c);if(a=this.show(a),this.fh>=-G-90){let q=this.q.t;this.show([{c:cm(this.c,1.25),p:q}])}this.edge(this.q.fe)}edge(e){let ro=E?cm(this.c,.7):cm(ln,.7);pg.stroke(lc(ro,bg,this.f)),pg.strokeWeight(2-2*this.f);for(let i=0;i<e.length-1;i+=2){let p1=e[i],p2=e[i+1];pg.line(p1.x,p1.y,p2.x,p2.y)}}show(a){for(let q of a){pg.beginShape(),pg.noFill(),pg.strokeWeight(1.5),pg.stroke(lc(q.c,bg,this.f));for(let p of q.p)pg.vertex(p.x,p.y);pg.endShape(CLOSE)}for(let q of a){pg.beginShape(),pg.fill(lc(q.c,bg,this.f)),pg.noStroke();for(let p of q.p)pg.vertex(p.x,p.y);pg.endShape()}return a=[]}}function sd(p1,p2,p3,p4,array,hv,cmod,md,c=0,depth=0){let p01,p02,p03,p04,p11,p12,p13,p14,w1,w2,h1,h2,w0,h0,c1=cm(C[depth%C.length],cmod),c2=cm(C[(depth+1)%C.length],cmod);if(E&&1!=B){let dm=cm(c,map(depth,0,6,.5,1.5)*cmod);c1=dm,c2=dm}let nm=prt?3:6;L&&1!=B&&2==ri(0,nm)&&depth>3&&(c2=lc(cm(rc(gl),cmod),c2,.3));let a=0==B&&A?R():.5;hv?(p01=p1,p02=p2,p03=mp(p2,p3,a),p04=mp(p1,p4,a),p11=p04,p12=p03,p13=p3,p14=p4):(p01=p1,p02=mp(p1,p2,a),p03=mp(p4,p3,a),p04=p4,p11=p02,p12=p2,p13=p3,p14=p03),depth++,hv=!hv,w1=p02.x-p01.x,w2=p12.x-p11.x,h1=p04.y-p01.y,h2=p14.y-p11.y,w0=min(w1,w2),h0=min(h1,h2);let r2={p:[p01,p02,p03,p04],c:c1},r1={p:[p11,p12,p13,p14],c:c2};if(depth<md&&(1==B||w0>5&&h0>5)){let r=depth<8&&1==B?2:0==B&&!ovg||1==B&&nyc?rl[depth]:floor(4*sn(oo+p01.x,oo+p14.y,sca));(0==r||r>1)&&sd(p01,p02,p03,p04,array,hv,cmod,md,c,depth),(1==r||r>1)&&sd(p11,p12,p13,p14,array,hv,cmod,md,c,depth),0==r&&array.push(r1),1==r&&array.push(r2)}else array.push(r2,r1)}function sn(a,b,sc){let n=noise(a*sc,b*sc),x=100*sin(.5*a),y=100*cos(b*n);return norm(cos(x+y),-1,1)}function sp(p){let c=[],f=[];arrayCopy(p,c);let l=p.length;for(let t=0;t<l;t++){let i=ri(0,c.length-1);f.push(c[i]),c.splice(i,1)}return f}function gp(c,n=7){let k=1/n,p=[],d=0;for(let i=0;i<c.length-1;i++){let a=c[i],b=c[i+1];for(let j=0;j<1-k;j+=k)p.push(lc(a,b,j))}return p}function sa(a){let l=a.length,c=0;for(;c<l;)for(let i=0;i<l-1;i++){let y1=a[i],y2=a[i+1];if(c++,y1.p[3].y>y2.p[3].y){a[i]=y2,a[i+1]=y1,c=0;break}}for(c=0;c<l;)for(let i=0;i<l-1;i++){let x1=a[i],x2=a[i+1];if(c++,x1.p[3].y==x2.p[3].y&&x2.p[3].x<x1.p[3].x){a[i]=x2,a[i+1]=x1,c=0;break}}return a}function re(a,mn,mx){let r=[];for(let v of a){let p=v.p,x=lerp(p[3].x,p[2].x,.5),y=p[3].y,d=p[2].x-p[3].x;d<mx&&d>mn&&x>-hw-200&&x<hw+200&&y>-hw&&r.push(v)}return r}function ch(a){let r=ri(0,100),o=0,i=0;for(let u of a){if(r>o-1&&r<u+o)return i;i++,o+=u}return i}function mr(){let r=[];for(let i=0;i<20;i++)r.push(rc([0,1,2,3,4,5]));return r}function dk(c){let d=100,r=0;push(),colorMode(HSB,360,100,100);for(let t of c){let b=brightness(color(t));b<d&&(r=t,d=b)}return pop(),r}S=Uint32Array.from([0,1,s=t=2,3].map(i=>parseInt(tokenData.hash.substr(8*i+2,8),16))),
R=_=>(t=S[3],S[3]=S[2],S[2]=S[1],S[1]=s=S[0],t^=t<<11,S[0]^=t^t>>>8^s>>>19,S[0]/2**32),
'ty @piterpasma',
rb=(a,b)=>a+(b-a)*R(),ri=(a,b)=>floor(rb(a,b+1)),rc=a=>a[floor(rb(0,.99*a.length))],dv=(i,j)=>dist(i.x,i.y,j.x,j.y),mp=(i,j,a=.5)=>({x:lerp(i.x,j.x,a),y:lerp(i.y,j.y,a)}),lc=(a,b,c)=>lerpColor(color(a),color(b),c),lp=(a,b,c)=>lerp(a,b,c),cm=(c,r,a=255)=>color(red(c)*r,green(c)*r,blue(c)*r,a),db=(a,b)=>({x:a,y:b}),fr=(q,o=100)=>q[3].y>-hw-o&&q[0].y<hw+o&&q[2].x<hw+o&&q[0].x>-hw-o;